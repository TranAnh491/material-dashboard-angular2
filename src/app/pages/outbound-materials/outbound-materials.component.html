<div class="main-content" (click)="focusScannerInput()">
  <!-- Excel-like Container -->
  <div class="excel-container">
    <!-- Excel-like Header -->
    <div class="excel-header">
      <h4>üì§ Outbound Materials</h4>
      <p>L·ªãch s·ª≠ xu·∫•t h√†ng t·ª´ kho</p>
    </div>

    <!-- Excel-like Actions -->
    <div class="excel-actions">
      <div class="action-buttons">
        <button class="btn btn-primary" (click)="startScannerMode()" [disabled]="isScannerActive">
          <i class="material-icons">qr_code_scanner</i>
          B·∫≠t Scanner
        </button>
        <button class="btn btn-secondary" (click)="stopScannerMode()" [disabled]="!isScannerActive">
          <i class="material-icons">stop</i>
          D·ª´ng Scanner
        </button>
        <button class="btn btn-info" (click)="showScannerStatus()" [disabled]="!isScannerActive">
          <i class="material-icons">info</i>
          Tr·∫°ng th√°i
        </button>
        <div class="scanner-test" *ngIf="isScannerActive">
          <input type="text" 
                 placeholder="Test QR data (format: MaterialCode|PO|Quantity)" 
                 class="test-input"
                 (keyup.enter)="testScannerInput($event)">
          <small>Nh·∫≠p d·ªØ li·ªáu test v√† nh·∫•n Enter</small>
        </div>
        
        <!-- Hidden scanner input for real scanner -->
        <input type="text" 
               #scannerInput
               class="hidden-scanner-input"
               *ngIf="isScannerActive"
               (keyup.enter)="handleRealScannerInput($event)"
               autocomplete="off"
               style="position: absolute; left: -9999px; opacity: 0;">
      </div>
      
      <div class="search-box">
        <input type="text" 
               placeholder="T√¨m ki·∫øm..." 
               [(ngModel)]="searchTerm"
               (input)="onSearchChange($event)"
               class="search-input">
      </div>
      
      <div class="date-filters">
        <input type="date" 
               [(ngModel)]="startDate"
               (change)="applyDateRangeFilter()"
               class="date-input">
        <span>ƒë·∫øn</span>
        <input type="date" 
               [(ngModel)]="endDate"
               (change)="applyDateRangeFilter()"
               class="date-input">
      </div>
    </div>

    <!-- Excel-like Body -->
    <div class="excel-body">
      <table class="excel-table">
        <thead>
          <tr>
            <th class="row-header">#</th>
            <th>Ng√†y xu·∫•t</th>
            <th>M√£ h√†ng</th>
            <th>S·ªë P.O</th>
            <th>S·ªë l∆∞·ª£ng g·ªëc</th>
            <th>S·ªë l∆∞·ª£ng xu·∫•t</th>
            <th>V·ªã tr√≠</th>
            <th>Ph∆∞∆°ng th·ª©c</th>
            <th>Ng∆∞·ªùi xu·∫•t</th>
            <th>X√≥a</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let material of filteredOutbound; let i = index">
            <td class="row-header">{{i + 1}}</td>
            <td class="date-cell">{{material.exportDate | date:'dd/MM/yyyy HH:mm'}}</td>
            <td class="code-cell">{{material.materialCode}}</td>
            <td>{{material.poNumber}}</td>
            <td class="number-cell">{{material.quantity}}</td>
            <td class="number-cell">{{material.exportQuantity}}</td>
            <td>{{material.location}}</td>
            <td class="method-cell">
              <span class="badge" [class.badge-success]="material.scanMethod === 'QR_SCAN'" 
                    [class.badge-info]="!material.scanMethod || material.scanMethod === 'MANUAL'">
                {{material.scanMethod === 'QR_SCAN' ? 'QR Scan' : 'Manual'}}
              </span>
            </td>
            <td>{{material.exportedBy}}</td>
            <td class="status-cell">
              <button mat-icon-button color="warn" 
                      (click)="deleteOutboundRecord(material)"
                      matTooltip="X√≥a record n√†y">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- No Data Message -->
      <div class="no-data" *ngIf="filteredOutbound.length === 0">
        <i class="material-icons">inventory_2</i>
        <h5>Ch∆∞a c√≥ record xu·∫•t h√†ng</h5>
        <p>L·ªãch s·ª≠ xu·∫•t h√†ng s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y khi c√≥ ho·∫°t ƒë·ªông qu√©t QR t·ª´ tab Inventory</p>
      </div>
    </div>
  </div>
</div>

<!-- Scanner Status Modal -->
<div class="scanner-modal" [class.show]="showScannerModal">
  <div class="modal-overlay" (click)="closeScannerModal()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h5>üìä Tr·∫°ng th√°i Scanner</h5>
      <button class="close-btn" (click)="closeScannerModal()">
        <i class="material-icons">close</i>
      </button>
    </div>
    <div class="modal-body">
      <div class="scanner-status">
        <div class="status-item">
          <span class="label">Tr·∫°ng th√°i:</span>
          <span class="value" [class.active]="isScannerActive">
            {{isScannerActive ? 'üü¢ ƒêang ho·∫°t ƒë·ªông' : 'üî¥ ƒê√£ d·ª´ng'}}
          </span>
        </div>
        <div class="status-item">
          <span class="label">S·ªë l·∫ßn qu√©t:</span>
          <span class="value">{{scanCount}}</span>
        </div>
        <div class="status-item">
          <span class="label">Th√†nh c√¥ng:</span>
          <span class="value success">{{successfulScans}}</span>
        </div>
        <div class="status-item">
          <span class="label">L·ªói:</span>
          <span class="value error">{{errorScans}}</span>
        </div>
        <div class="status-item">
          <span class="label">T·ªëc ƒë·ªô:</span>
          <span class="value">{{scanRate}} qu√©t/ph√∫t</span>
        </div>
      </div>
      
      <div class="recent-scans">
        <h6>Qu√©t g·∫ßn ƒë√¢y:</h6>
        <div class="scan-list">
          <div class="scan-item" *ngFor="let scan of recentScans">
            <span class="scan-time">{{scan.timestamp | date:'HH:mm:ss'}}</span>
            <span class="scan-data">{{scan.data}}</span>
            <span class="scan-result" [class.success]="scan.success" [class.error]="!scan.success">
              {{scan.success ? '‚úÖ' : '‚ùå'}}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
