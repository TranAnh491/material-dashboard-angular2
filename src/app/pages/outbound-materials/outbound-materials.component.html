<div class="main-content" (click)="focusScannerInput()">
  <!-- Excel-like Container -->
  <div class="excel-container">
    <!-- Excel-like Header -->
    <div class="excel-header">
      <h4>üì§ Outbound Materials</h4>
      <p>L·ªãch s·ª≠ xu·∫•t h√†ng t·ª´ kho - T·ª± ƒë·ªông ·∫©n l·ªãch s·ª≠ c≈© m·ªói ng√†y m·ªõi</p>
    </div>

    <!-- Excel-like Actions -->
    <div class="excel-actions">
      <div class="action-buttons">
        <!-- Factory Selection Buttons -->
        <button class="custom-btn" 
                [class.active]="selectedFactory === 'ASM1'"
                (click)="selectFactory('ASM1')">
          <i class="material-icons">filter_1</i>
          ASM1
        </button>
        <button class="custom-btn" 
                [class.active]="selectedFactory === 'ASM2'"
                (click)="selectFactory('ASM2')">
          <i class="material-icons">filter_2</i>
          ASM2
        </button>
        
        <!-- Simplified Scanner Controls -->
        <button class="btn btn-primary" (click)="startBatchScan()" [disabled]="isScannerActive || !selectedFactory">
          <i class="material-icons">qr_code_scanner</i>
          Ch·ªçn Batch Scan
        </button>
        <button class="btn btn-secondary" (click)="stopScannerMode()" [disabled]="!isScannerActive">
          <i class="material-icons">stop</i>
          D·ª´ng Scanner
        </button>
        
        <!-- More Options Dropdown -->
        <div class="dropdown">
          <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="material-icons">more_vert</i>
            More
          </button>
          <ul class="dropdown-menu">
            <li><h6 class="dropdown-header">üìä B√°o c√°o FIFO</h6></li>
            <li><a class="dropdown-item" href="#" (click)="downloadFIFOReportASM1()">
              <i class="material-icons">download</i>
              FIFO Report ASM1
            </a></li>
            <li><a class="dropdown-item" href="#" (click)="downloadFIFOReportASM2()">
              <i class="material-icons">download</i>
              FIFO Report ASM2
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">üîÑ Qu·∫£n l√Ω d·ªØ li·ªáu</h6></li>
            <li><a class="dropdown-item" href="#" (click)="loadOutboundMaterialsFromFirebase()">
              <i class="material-icons">refresh</i>
              L√†m m·ªõi d·ªØ li·ªáu
            </a></li>
            <li><a class="dropdown-item" href="#" (click)="cleanupPreviousDayRecords()" 
                   [class.disabled]="!hidePreviousDayHistory"
                   title="{{ hidePreviousDayHistory ? 'X√≥a d·ªØ li·ªáu ng√†y h√¥m qua' : 'Ch·ªâ c√≥ th·ªÉ x√≥a khi ƒë√£ ·∫©n l·ªãch s·ª≠ c≈©' }}">
              <i class="material-icons">cleaning_services</i>
              X√≥a d·ªØ li·ªáu c≈©
            </a></li>
          </ul>
        </div>
        
        <!-- Batch Scan Input -->
        <div class="batch-scan-input" *ngIf="isScannerActive">
          <input type="text" 
                 placeholder="Scan l·ªánh s·∫£n xu·∫•t v√† m√£ nh√¢n vi√™n" 
                 class="batch-input"
                 (keyup.enter)="handleBatchScanInput($event)">
          <small>Qu√©t QR code l·ªánh s·∫£n xu·∫•t v√† m√£ nh√¢n vi√™n</small>
        </div>
        
        <!-- Hidden scanner input for real scanner -->
        <input type="text" 
               #scannerInput
               class="hidden-scanner-input"
               *ngIf="isScannerActive"
               (keyup.enter)="handleRealScannerInput($event)"
               autocomplete="off"
               style="position: absolute; left: -9999px; opacity: 0;">
      </div>
      
      <div class="search-box">
        <input type="text" 
               placeholder="T√¨m ki·∫øm..." 
               [(ngModel)]="searchTerm"
               (input)="onSearchChange($event)"
               class="search-input">
      </div>
      
      <div class="date-filters">
        <input type="date" 
               [(ngModel)]="startDate"
               (change)="applyDateRangeFilter()"
               class="date-input">
        <span>ƒë·∫øn</span>
        <input type="date" 
               [(ngModel)]="endDate"
               (change)="applyDateRangeFilter()"
               class="date-input">
        
        <!-- Toggle for hiding previous day's scan history -->
        <div class="history-toggle">
          <label class="toggle-label">
            <input type="checkbox" 
                   [(ngModel)]="hidePreviousDayHistory"
                   (change)="toggleHidePreviousDayHistory()"
                   class="toggle-checkbox">
            <span class="toggle-text">
              <i class="material-icons">{{ hidePreviousDayHistory ? 'visibility_off' : 'visibility' }}</i>
              {{ hidePreviousDayHistory ? '·∫®n l·ªãch s·ª≠ c≈©' : 'Hi·ªán t·∫•t c·∫£' }}
            </span>
          </label>
        </div>
        
        <!-- Reset to today button -->
        <button class="today-btn" 
                (click)="resetToToday()"
                title="Reset v·ªÅ ng√†y h√¥m nay">
          <i class="material-icons">today</i>
          H√¥m nay
        </button>
      </div>
    </div>

    <!-- Excel-like Body -->
    <div class="excel-body">
      <table class="excel-table">
        <thead>
          <tr>
            <th>Factory</th>
            <th class="row-header">#</th>
            <th>Ng√†y xu·∫•t</th>
            <th>M√£ h√†ng</th>
            <th>S·ªë P.O</th>
            <th>S·ªë l∆∞·ª£ng g·ªëc</th>
            <th>S·ªë l∆∞·ª£ng xu·∫•t</th>
            <th>V·ªã tr√≠</th>
            <th>Ph∆∞∆°ng th·ª©c</th>
            <th>Ng∆∞·ªùi xu·∫•t</th>
            <th>X√≥a</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let material of filteredOutbound; let i = index">
            <td class="factory-cell" 
                [class.factory-asm1]="(material.factory || 'ASM1') === 'ASM1'" 
                [class.factory-asm2]="(material.factory || 'ASM1') === 'ASM2'">
              {{material.factory || 'ASM1'}}
            </td>
            <td class="row-header">{{i + 1}}</td>
            <td class="date-cell">{{material.exportDate | date:'dd/MM/yyyy HH:mm'}}</td>
            <td class="code-cell">{{material.materialCode}}</td>
            <td>{{material.poNumber}}</td>
            <td class="number-cell">{{material.quantity}}</td>
            <td class="number-cell">{{material.exportQuantity}}</td>
            <td>{{material.location}}</td>
            <td class="method-cell">
              <span class="badge" [class.badge-success]="material.scanMethod === 'QR_SCAN'" 
                    [class.badge-info]="!material.scanMethod || material.scanMethod === 'MANUAL'">
                {{material.scanMethod === 'QR_SCAN' ? 'QR Scan' : 'Manual'}}
              </span>
            </td>
            <td>{{material.exportedBy}}</td>
            <td class="status-cell">
              <button mat-icon-button color="warn" 
                      (click)="deleteOutboundRecord(material)"
                      matTooltip="X√≥a record n√†y">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- No Data Message -->
      <div class="no-data" *ngIf="filteredOutbound.length === 0">
        <i class="material-icons">inventory_2</i>
        <h5>Ch∆∞a c√≥ record xu·∫•t h√†ng</h5>
        <p>L·ªãch s·ª≠ xu·∫•t h√†ng s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y khi c√≥ ho·∫°t ƒë·ªông qu√©t QR t·ª´ tab Inventory</p>
      </div>
    </div>
  </div>
</div>
