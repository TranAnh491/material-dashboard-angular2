<div class="main-content">
  <!-- Excel-like Container -->
  <div class="excel-container">
    <!-- Report Title -->
    <div class="excel-header">
      <h4>üìç LOCATION MANAGEMENT</h4>
    </div>
    
    <!-- Excel Actions -->
    <div class="excel-actions">
      <div class="action-controls-horizontal">
        <!-- More Button with Dropdown -->
        <div class="dropdown">
          <button class="more-btn" (click)="toggleDropdown($event)">
            <i class="material-icons">more_vert</i>
            More
          </button>
          <div class="dropdown-menu" [class.show]="isDropdownOpen">
            <a class="dropdown-item" href="javascript:void(0)" (click)="exportToExcel()">
              <i class="material-icons">file_download</i>
              Export to Excel
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="javascript:void(0)" (click)="initializeSampleData()">
              <i class="material-icons">add_circle</i>
              Initialize Sample Data
            </a>
          </div>
        </div>
        
        <!-- Total Counter Box -->
        <div class="total-counter-box">
          <i class="material-icons">location_on</i>
          <span>T·ªïng: {{ filteredItems.length }} v·ªã tr√≠</span>
        </div>
        
        <!-- Search Box -->
        <div class="search-box">
          <input type="text"
                 [placeholder]="isLoading ? 'üîç ƒêang t·∫£i...' : 'Nh·∫≠p ƒë·ªÉ t√¨m ki·∫øm'"
                 [(ngModel)]="searchTerm"
                 (input)="onSearchInput($event)"
                 (keyup)="onSearchKeyUp($event)"
                 class="search-input"
                 [disabled]="isLoading">
          
          <!-- Clear search button -->
          <button class="clear-search-btn" 
                  *ngIf="searchTerm" 
                  (click)="clearSearch()" 
                  title="X√≥a t√¨m ki·∫øm">
            <i class="material-icons">clear</i>
          </button>
          
          <!-- Search warning -->
          <div class="search-warning" *ngIf="searchTerm && searchTerm.length < 2">
            <i class="material-icons">info</i>
            C·∫ßn √≠t nh·∫•t 2 k√Ω t·ª±
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="refresh-btn" (click)="refreshData()" title="L√†m m·ªõi d·ªØ li·ªáu Location">
            <i class="material-icons">refresh</i>
            Refresh
          </button>
        </div>
      </div>
    </div>

    <!-- Add New Item Form -->
    <div class="add-item-form">
      <h5>‚ûï Th√™m V·ªã Tr√≠ M·ªõi</h5>
      <div class="form-row">
        <div class="form-group">
          <label for="newViTri">V·ªã Tr√≠:</label>
          <input type="text" 
                 id="newViTri"
                 [(ngModel)]="newItem.viTri" 
                 (input)="onViTriInputChange($event)"
                 [class.valid]="newItem.viTri && validateViTriInput(newItem.viTri)"
                 [class.invalid]="newItem.viTri && !validateViTriInput(newItem.viTri)"
                 class="form-input"
                 placeholder="VD: A1-01, B2-03"
                 maxlength="20"
                 title="Ch·ªâ cho ph√©p ch·ªØ c√°i, s·ªë, d·∫•u ch·∫•m (.) v√† d·∫•u g·∫°ch ngang (-)">
          <div class="validation-message" 
               [class.error]="newItem.viTri && !validateViTriInput(newItem.viTri)"
               [class.success]="newItem.viTri && validateViTriInput(newItem.viTri)"
               *ngIf="newItem.viTri">
            <span *ngIf="!validateViTriInput(newItem.viTri)">
              ‚ö†Ô∏è Ch·ªâ cho ph√©p ch·ªØ c√°i, s·ªë, d·∫•u ch·∫•m (.) v√† d·∫•u g·∫°ch ngang (-)
            </span>
            <span *ngIf="validateViTriInput(newItem.viTri)">
              ‚úÖ ƒê·ªãnh d·∫°ng h·ª£p l·ªá
            </span>
          </div>
        </div>
        
        <div class="form-group">
          <button class="add-btn" (click)="addLocationItem()" title="Th√™m v·ªã tr√≠ m·ªõi">
            <i class="material-icons">add</i>
            Th√™m
          </button>
        </div>
      </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading-container" *ngIf="isLoading">
      <div class="loading-spinner">
        <i class="material-icons rotating">sync</i>
        <span>ƒêang t·∫£i d·ªØ li·ªáu Location...</span>
      </div>
    </div>

    <!-- Table Container -->
    <div class="table-container" *ngIf="!isLoading">
      <!-- Table -->
      <table class="excel-table">
        <thead>
          <tr>
            <th>STT</th>
            <th>V·ªã Tr√≠</th>
            <th>QR Code</th>
            <th>Thao T√°c</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filteredItems; trackBy: trackByFn; let i = index">
            <!-- STT Column -->
            <td class="stt-cell">
              <ng-container *ngIf="editingItem?.id !== item.id; else editStt">
                {{ item.stt }}
              </ng-container>
              <ng-template #editStt>
                <input type="number" 
                       [(ngModel)]="editingItem.stt" 
                       class="edit-input"
                       min="1">
              </ng-template>
            </td>
            
            <!-- V·ªã Tr√≠ Column -->
            <td class="vitri-cell">
              <ng-container *ngIf="editingItem?.id !== item.id; else editViTri">
                {{ item.viTri }}
              </ng-container>
              <ng-template #editViTri>
                <input type="text" 
                       [(ngModel)]="editingItem.viTri" 
                       (input)="onViTriInputChange($event, true)"
                       [class.valid]="editingItem.viTri && validateViTriInput(editingItem.viTri)"
                       [class.invalid]="editingItem.viTri && !validateViTriInput(editingItem.viTri)"
                       class="edit-input"
                       placeholder="Nh·∫≠p v·ªã tr√≠"
                       maxlength="20"
                       title="Ch·ªâ cho ph√©p ch·ªØ c√°i, s·ªë, d·∫•u ch·∫•m (.) v√† d·∫•u g·∫°ch ngang (-)">
                <div class="validation-message" 
                     [class.error]="editingItem.viTri && !validateViTriInput(editingItem.viTri)"
                     [class.success]="editingItem.viTri && validateViTriInput(editingItem.viTri)"
                     *ngIf="editingItem.viTri">
                  <span *ngIf="!validateViTriInput(editingItem.viTri)">
                    ‚ö†Ô∏è Ch·ªâ cho ph√©p ch·ªØ c√°i, s·ªë, d·∫•u ch·∫•m (.) v√† d·∫•u g·∫°ch ngang (-)
                  </span>
                  <span *ngIf="validateViTriInput(editingItem.viTri)">
                    ‚úÖ ƒê·ªãnh d·∫°ng h·ª£p l·ªá
                  </span>
                </div>
              </ng-template>
            </td>
            
                         <!-- QR Code Column -->
             <td class="qr-cell">
               <button class="qr-btn" 
                       (click)="printQRCode(item)"
                       title="T·∫°o QR code cho {{item.viTri}}"
                       *ngIf="editingItem?.id !== item.id">
                 <i class="material-icons">qr_code</i>
               </button>
             </td>
            
            <!-- Actions Column -->
            <td class="actions-cell">
              <ng-container *ngIf="editingItem?.id !== item.id; else editActions">
                <button class="edit-btn" 
                        (click)="editLocationItem(item)"
                        title="S·ª≠a {{item.viTri}}">
                  <i class="material-icons">edit</i>
                </button>
                <button class="delete-btn" 
                        (click)="deleteLocationItem(item)"
                        title="X√≥a {{item.viTri}}"
                        *ngIf="canDelete">
                  <i class="material-icons">delete</i>
                </button>
              </ng-container>
              <ng-template #editActions>
                <button class="save-btn" 
                        (click)="saveEditedItem()"
                        title="L∆∞u thay ƒë·ªïi">
                  <i class="material-icons">save</i>
                </button>
                <button class="cancel-btn" 
                        (click)="cancelEdit()"
                        title="H·ªßy b·ªè">
                  <i class="material-icons">cancel</i>
                </button>
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!searchTerm && filteredItems.length === 0 && !isLoading">
        <div class="empty-state-content">
          <i class="material-icons">location_off</i>
          <h3>üìç Ch∆∞a c√≥ v·ªã tr√≠ n√†o</h3>
          <p>H√£y th√™m v·ªã tr√≠ m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu qu·∫£n l√Ω</p>
          
          <!-- Quick Stats -->
          <div class="quick-stats">
            <div class="stat-item">
              <i class="material-icons">add_location</i>
              <span>Th√™m V·ªã Tr√≠</span>
            </div>
            <div class="stat-item">
              <i class="material-icons">qr_code</i>
              <span>QR T·ª± ƒê·ªông</span>
            </div>
            <div class="stat-item">
              <i class="material-icons">print</i>
              <span>In Tem QR</span>
            </div>
          </div>
        </div>
      </div>

      <!-- No Search Results -->
      <div class="no-results" *ngIf="searchTerm && filteredItems.length === 0 && !isLoading">
        <div class="no-results-content">
          <i class="material-icons">search_off</i>
          <h4>üîç Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</h4>
          <p>Kh√¥ng t√¨m th·∫•y v·ªã tr√≠ n√†o cho "<strong>{{searchTerm}}</strong>"</p>
          
          <!-- Search Tips -->
          <div class="search-tips">
            <h6>üí° M·∫πo t√¨m ki·∫øm:</h6>
            <ul>
              <li>Ki·ªÉm tra ch√≠nh t·∫£</li>
              <li>Th·ª≠ t√¨m ki·∫øm v·ªõi √≠t k√Ω t·ª± h∆°n</li>
              <li>Th·ª≠ t√¨m ki·∫øm theo STT ho·∫∑c v·ªã tr√≠</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="loading-content">
          <i class="material-icons rotating">sync</i>
          <h4>üîç ƒêang t√¨m ki·∫øm...</h4>
          <p>T√¨m ki·∫øm "<strong>{{searchTerm}}</strong>" trong Location</p>
        </div>
      </div>
    </div>
  </div>
</div>
