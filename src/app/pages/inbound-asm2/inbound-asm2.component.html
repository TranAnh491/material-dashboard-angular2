<div class="main-content">
  <!-- Excel-like Container -->
  <div class="excel-container">
    <!-- Excel-like Header -->
    <div class="excel-header">
      <h4>üì¶ INBOUND ASM2</h4>
    </div>
    
    <!-- Excel-like Actions -->
    <div class="excel-actions">
      <div class="action-controls-horizontal">
        <!-- More Button with Dropdown -->
        <div class="dropdown">
          <button class="more-btn" (click)="toggleDropdown()">
            <i class="material-icons">more_vert</i>
            More
          </button>
          <div class="dropdown-menu" [class.show]="showDropdown">
            <a class="dropdown-item" href="javascript:void(0)" (click)="importFile(); $event.preventDefault()">
              <i class="material-icons">file_upload</i>
              Import Excel
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="downloadTemplate(); $event.preventDefault()">
              <i class="material-icons">description</i>
              Download Template
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="exportToExcel(); $event.preventDefault()">
              <i class="material-icons">download</i>
              Export Excel
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="javascript:void(0)" (click)="addMaterial(); $event.preventDefault()">
              <i class="material-icons">add</i>
              Th√™m Material
            </a>
            <a class="dropdown-item delete-all-item" href="javascript:void(0)" (click)="deleteAllMaterials()">
              <i class="material-icons">delete_sweep</i>
              X√≥a t·∫•t c·∫£
            </a>
          </div>
        </div>
        
        <!-- Total Materials Counter -->
        <div class="total-counter-box">
          <span>T·ªïng: {{filteredMaterials.length}} materials</span>
        </div>
        
        <!-- Search Box -->
        <div class="search-box">
          <input type="text" 
                 [placeholder]="getSearchPlaceholder()"
                 [(ngModel)]="searchTerm"
                 (input)="onSearchInput($event)"
                 class="search-input">
        </div>
        
        <!-- Filter Buttons -->
        <div class="filter-buttons">
          <!-- Search Type Filter -->
          <div class="filter-group">
            <select class="filter-select" 
                    [(ngModel)]="searchType" 
                    (change)="changeSearchType($event.target.value)">
              <option value="materialCode">M√£ H√†ng</option>
              <option value="batchNumber">L√¥ H√†ng</option>
            </select>
          </div>
          
          <!-- Status Filter -->
          <div class="filter-group">
            <select class="filter-select" 
                    [(ngModel)]="statusFilter" 
                    (change)="changeStatusFilter($event.target.value)">
              <option value="pending">Ch∆∞a</option>
              <option value="completed">Ho√†n Th√†nh</option>
            </select>
          </div>
        </div>
        
        <!-- Date Range Selector -->
        <div class="date-range-selector">
          <input type="date" 
                 [(ngModel)]="startDate" 
                 (change)="applyFilters()"
                 class="date-input"
                 title="T·ª´ ng√†y">
          <span class="date-separator">‚Üí</span>
          <input type="date" 
                 [(ngModel)]="endDate" 
                 (change)="applyFilters()"
                 class="date-input"
                 title="ƒê·∫øn ng√†y">
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="clear-btn" (click)="clearFilters()">
            <i class="material-icons">clear</i>
            Reset
          </button>
          
          <!-- Refresh Button -->
          <button class="refresh-btn" (click)="loadMaterials()">
            <i class="material-icons">refresh</i>
            Refresh
          </button>
        </div>
        
        <!-- Factory Badge -->
        <span class="factory-badge asm2-badge">ASM2</span>
      </div>
    </div>
    
    <!-- Loading State -->
    <div class="loading-container" *ngIf="isLoading">
      <div class="loading-spinner">
        <i class="material-icons spinning">refresh</i>
        <span>ƒêang t·∫£i d·ªØ li·ªáu ASM2...</span>
      </div>
    </div>
    
    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">
      <i class="material-icons">error</i>
      {{errorMessage}}
    </div>
    
    <!-- Excel-like Body -->
    <div class="excel-body" *ngIf="!isLoading">
      <table class="excel-table">
        <thead>
          <tr>
            <th class="factory-cell">FACTORY</th>
            <th class="row-header">#</th>
            <th class="date-cell">NG√ÄY NH·∫¨P</th>
            <th class="batch-cell">L√î H√ÄNG/ DNNK</th>
            <th class="code-cell">M√É H√ÄNG</th>
            <th class="po-cell">S·ªê P.O</th>
            <th class="number-cell">L∆Ø·ª¢NG NH·∫¨P</th>
            <th class="location-cell">V·ªä TR√ç</th>
            <th class="type-cell">LO·∫†I H√åNH</th>
            <th class="date-cell">HSD</th>
            <th class="status-cell">KK</th>
            <th class="status-cell">ƒê√É NH·∫¨N</th>
            <th class="number-cell">L∆Ø·ª¢NG ƒê∆†N V·ªä</th>
            <th class="supplier-cell">NH√Ä CUNG C·∫§P</th>
            <th class="remarks-cell">L∆ØU √ù</th>
            <th class="status-cell">TR·∫†NG TH√ÅI</th>
            <th class="action-cell">HO√ÄN TH√ÄNH</th>
            <th class="action-cell">X√ìA</th>
            <th class="action-cell">QR</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let material of filteredMaterials; let i = index" 
              [class.received-row]="material.isReceived"
              [class.completed-row]="material.isCompleted">
            <td class="factory-cell factory-asm2">
              ASM2
            </td>
            <td class="row-header">{{i + 1}}</td>
            <td class="date-cell">{{formatDate(material.importDate)}}</td>
            <td class="batch-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.batchNumber" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'S·ª≠a l√¥ h√†ng'">
            </td>
            <td class="code-cell" 
                [class.material-code-printed]="material.hasQRGenerated"
                [class.material-received]="material.isReceived">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.materialCode" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'S·ª≠a m√£ h√†ng'">
            </td>
            <td class="po-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.poNumber" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'S·ª≠a s·ªë PO'">
            </td>
            <td class="number-cell">
              <input type="number" 
                     class="editable-input" 
                     [(ngModel)]="material.quantity" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'S·ª≠a s·ªë l∆∞·ª£ng'">
            </td>
            <td class="location-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.location" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'S·ª≠a v·ªã tr√≠'"
                     placeholder="V·ªã tr√≠">
            </td>
            <td class="type-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.type" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'S·ª≠a lo·∫°i h√¨nh'"
                     placeholder="Lo·∫°i">
            </td>
            <td class="date-cell">
              <input type="date" 
                     class="date-input" 
                     [value]="material.expiryDate ? material.expiryDate.toISOString().split('T')[0] : ''"
                     (change)="onExpiryDateChange($event, material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'S·ª≠a h·∫°n s·ª≠ d·ª•ng'">
            </td>
            <td class="status-cell">
              <input type="checkbox" 
                     [checked]="material.qualityCheck" 
                     (change)="onQualityCheckChange($event, material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'Ki·ªÉm tra ch·∫•t l∆∞·ª£ng'">
            </td>
            <td class="status-cell">
              <input type="checkbox" 
                     [checked]="material.isReceived" 
                     (change)="onReceivedChange($event, material)"
                     [disabled]="material.isReceived || !canEditMaterials"
                     [title]="material.isReceived ? 'ƒê√£ nh·∫≠n - kh√¥ng th·ªÉ thay ƒë·ªïi' : 'ƒê√°nh d·∫•u ƒë√£ nh·∫≠n'">
            </td>
            <td class="number-cell">
              <input type="number" 
                     class="editable-input" 
                     [(ngModel)]="material.rollsOrBags" 
                     (change)="updateMaterial(material)"
                     min="0"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'S·ª≠a l∆∞·ª£ng ƒë∆°n v·ªã'">
            </td>
            <td class="supplier-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.supplier" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'S·ª≠a nh√† cung c·∫•p'"
                     placeholder="Nh√† cung c·∫•p">
            </td>
            <td class="remarks-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.remarks" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'Kh√¥ng th·ªÉ s·ª≠a - ƒë√£ trong Inventory' : 'S·ª≠a l∆∞u √Ω'"
                     placeholder="L∆∞u √Ω">
            </td>
            <td class="status-cell">
              <span class="status-badge" [ngClass]="getStatusBadgeClass(material)">{{getStatusText(material)}}</span>
            </td>
            <td class="status-cell">
              <button class="action-btn complete-btn" 
                      (click)="onMarkCompleted(material)" 
                      [disabled]="material.isCompleted || !canEditMaterials" 
                      [title]="material.isCompleted ? 'ƒê√£ ho√†n th√†nh' : 'ƒê√°nh d·∫•u ho√†n th√†nh'">
                <i class="material-icons">check_circle</i>
              </button>
            </td>
            <td class="status-cell">
              <button class="action-btn delete-btn" 
                      (click)="deleteMaterial(material)" 
                      [disabled]="!canDeleteMaterials" 
                      [title]="material.isReceived ? 'X√≥a kh·ªèi Inbound (kh√¥ng ·∫£nh h∆∞·ªüng Inventory)' : 'X√≥a material'">
                <i class="material-icons">delete</i>
              </button>
            </td>
                         <td class="qr-cell">
               <button class="print-qr-btn" 
                       (click)="printQRCode(material)" 
                       [disabled]="!canGenerateQR || !material.rollsOrBags || material.rollsOrBags <= 0"
                       [title]="!material.rollsOrBags || material.rollsOrBags <= 0 ? 'Vui l√≤ng nh·∫≠p l∆∞·ª£ng ƒë∆°n v·ªã tr∆∞·ªõc' : 'In tem QR code'">
                 <i class="material-icons">print</i>
                 Print
               </button>
             </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<input type="file" #fileInput accept=".xlsx,.xls,.csv" style="display: none" (change)="onFileSelect($event)">
