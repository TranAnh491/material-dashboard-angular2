<div class="main-content">
  <!-- Excel-like Container -->
  <div class="excel-container">
    <!-- Report Title -->
    <div class="excel-header">
      <h4>üì¶ INVENTORY ASM1</h4>
      <!-- Catalog Loading Indicator -->
      <div class="catalog-status" *ngIf="isCatalogLoading">
        <i class="material-icons rotating">sync</i>
        <span>ƒêang t·∫£i danh m·ª•c h√†ng h√≥a...</span>
      </div>
    </div>
    
    <!-- Excel Actions -->
    <div class="excel-actions">
      <div class="action-controls">
        <div class="dropdown">
          <button class="custom-btn dropdown-toggle" type="button" (click)="toggleDropdown($event)">
            <i class="material-icons">more_vert</i>
            More
          </button>
          <div class="dropdown-menu" [class.show]="isDropdownOpen">
            <a class="dropdown-item" href="javascript:void(0)" (click)="importCatalog()">
              <i class="material-icons">upload_file</i>
              Import File Danh m·ª•c
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="downloadCatalogTemplate()">
              <i class="material-icons">download</i>
              T·∫£i Template Danh m·ª•c
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="importCurrentStock()">
              <i class="material-icons">upload_file</i>
              Import T·ªìn kho ASM1
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="downloadStockTemplate()">
              <i class="material-icons">download</i>
              T·∫£i Template T·ªìn kho
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="exportToExcel()">
              <i class="material-icons">file_download</i>
              Export to Excel
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="javascript:void(0)" (click)="downloadFIFOReportASM1()">
              <i class="material-icons">warning</i>
              FIFO Report ASM1
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item danger-item" href="javascript:void(0)" (click)="deleteAllInventory()">
              <i class="material-icons">delete_forever</i>
              üóëÔ∏è X√≥a t·∫•t c·∫£ t·ªìn kho
            </a>
          </div>
        </div>
        

        
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="custom-btn" (click)="refreshInventory()" title="L√†m m·ªõi d·ªØ li·ªáu ASM1">
            <i class="material-icons">refresh</i>
            Refresh
          </button>
          <button class="custom-btn" (click)="syncFromInbound()" title="ƒê·ªìng b·ªô t·ª´ Inbound ASM1">
            <i class="material-icons">sync</i>
            Sync
          </button>
          <button class="custom-btn" (click)="resetZeroStock()" title="X√≥a h√†ng c√≥ t·ªìn kho = 0">
            <i class="material-icons">restart_alt</i>
            Reset
          </button>
          <!-- Search Box and Total Counter -->
          <div class="search-counter-container">
            <div class="inline-search-box">
              <input type="text" 
                     placeholder="üîç T√¨m ki·∫øm..." 
                     [(ngModel)]="searchTerm" 
                     (input)="onSearchInput($event)"
                     class="inline-search-input">
            </div>
            <div class="total-counter-box">
              <i class="material-icons">inventory_2</i>
              <span>T·ªïng: {{ filteredInventory.length }} m√£</span>
            </div>
          </div>
          <div class="catalog-ready-icon" *ngIf="!isCatalogLoading && catalogLoaded">
            <i class="material-icons">check_circle</i>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading-container" *ngIf="isLoading">
      <div class="loading-spinner">
        <i class="material-icons rotating">sync</i>
        <span>ƒêang t·∫£i d·ªØ li·ªáu ASM1...</span>
      </div>
    </div>



    <!-- Table Container -->
    <div class="table-container" *ngIf="!isLoading">
      <!-- Table -->
      <table class="excel-table">
        <thead>
          <tr>
            <th>Factory</th>
            <th>STT</th>
            <th>M√£ h√†ng</th>
            <th>PO</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>ƒê√£ xu·∫•t</th>
            <th>T·ªìn kho</th>
            <th>V·ªã tr√≠</th>
            <th>Thay ƒë·ªïi v·ªã tr√≠</th>
            <th>Lo·∫°i H√¨nh</th>

            <th>Rolls/Bags</th>
            <th>Tr·∫°ng th√°i</th>
            <th>X√≥a</th>
            <th>QR</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let material of filteredInventory; trackBy: trackByFn; let i = index" 
              [class.duplicate-row]="material.isDuplicate"
              [class.iqc-row]="isIQCLocation(material.location)">
            <td class="factory-cell factory-asm1">
              ASM1
            </td>
            <td class="row-header">{{i + 1}}</td>
            <td class="code-cell material-code-cell" 
                [class.duplicate-cell]="material.isDuplicate"
                [class.duplicate-code]="material.isDuplicate"
                [class.normal-code]="!material.isDuplicate">
              {{material.materialCode}}
            </td>
            <td class="po-cell" [class.duplicate-cell]="material.isDuplicate">{{material.poNumber}}</td>
            <td class="number-cell" [class.duplicate-cell]="material.isDuplicate">{{formatNumber(material.quantity)}}</td>
            <td class="number-cell">
              <input type="number" 
                     class="editable-cell" 
                     [(ngModel)]="material.exported" 
                     (change)="updateExported(material)" 
                     min="0"
                     step="0.1"
                     [disabled]="!canExport">
            </td>
            <td class="number-cell" [class.duplicate-cell]="material.isDuplicate" 
                [class.negative-stock-cell]="calculateCurrentStock(material) < 0"
                [title]="'L∆∞·ª£ng nh·∫≠p: ' + (material.quantity || 0) + ' - Xu·∫•t: ' + (material.exported || 0) + ' = ' + calculateCurrentStock(material)">
              {{formatNumber(calculateCurrentStock(material))}}
            </td>
            <td class="location-cell" [class.iqc-location]="isIQCLocation(material.location)">
              <input type="text" 
                     class="editable-cell location-input" 
                     [(ngModel)]="material.location" 
                     (change)="updateLocation(material)"
                     (blur)="onLocationChange(material)">
            </td>
            <td class="change-cell">
              <button class="scan-change-btn" 
                      (click)="scanLocationQR(material)"
                      title="Scan QR ƒë·ªÉ thay ƒë·ªïi v·ªã tr√≠">
                <i class="material-icons">qr_code_scanner</i>
                Scan
              </button>
            </td>
            <td>
              <input type="text" class="editable-cell" [(ngModel)]="material.type" (change)="updateType(material)">
            </td>

            <td class="number-cell">
              <input type="text" class="editable-cell" [(ngModel)]="material.rollsOrBags" (change)="updateRollsOrBags(material)">
            </td>
            <td class="status-cell">
              <span class="badge" 
                    [class]="getStatusClass(material)">
                {{ getStatusText(material) }}
              </span>
            </td>
            <td class="delete-cell">
              <button class="delete-btn" 
                      *ngIf="canDelete"
                      title="X√≥a item">
                <i class="material-icons">delete</i>
              </button>
            </td>
            <td class="qr-cell">
              <button class="qr-btn" 
                      (click)="printQRCode(material)"
                      title="T·∫°o QR code">
                <i class="material-icons">qr_code</i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
