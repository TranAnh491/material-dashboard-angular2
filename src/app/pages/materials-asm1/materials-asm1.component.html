<div class="main-content">
  <!-- Excel-like Container -->
  <div class="excel-container">
    <!-- Report Title -->
    <div class="excel-header">
      <h4>üì¶ INVENTORY ASM1</h4>
      <!-- Consolidation Status Message -->
      <div class="consolidation-message" *ngIf="showConsolidationMessage" [class.success]="consolidationMessage.includes('‚úÖ')" [class.info]="consolidationMessage.includes('‚ÑπÔ∏è')">
        <i class="material-icons">{{consolidationMessage.includes('‚úÖ') ? 'check_circle' : 'info'}}</i>
        <span>{{ consolidationMessage }}</span>
        <button class="close-message" (click)="showConsolidationMessage = false">
          <i class="material-icons">close</i>
        </button>
      </div>
      <!-- Catalog Loading Indicator -->
      <div class="catalog-status" *ngIf="isCatalogLoading">
        <i class="material-icons rotating">sync</i>
        <span>ƒêang t·∫£i danh m·ª•c h√†ng h√≥a...</span>
      </div>
    </div>
    
    <!-- Excel Actions -->
    <div class="excel-actions">
      <div class="action-controls-horizontal">
        <!-- Mobile Menu Button -->
        <div class="mobile-menu-btn" (click)="toggleMobileMenu()">
          <i class="material-icons">menu</i>
        </div>
        
        <!-- More Button with Dropdown -->
        <div class="dropdown">
          <button class="more-btn" (click)="toggleDropdown($event)">
            <i class="material-icons">more_vert</i>
            <span class="desktop-only">More</span>
          </button>
          <div class="dropdown-menu" [class.show]="isDropdownOpen">
            <a class="dropdown-item" href="javascript:void(0)" (click)="importCatalog()">
              <i class="material-icons">file_upload</i>
              Update Standard Packing
            </a>
            <!-- Import/Export -->
            <a class="dropdown-item" href="javascript:void(0)" (click)="downloadCatalogTemplate()">
              <i class="material-icons">description</i>
              Download Standard Packing Template
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="exportToExcel()">
              <i class="material-icons">file_download</i>
              Export to Excel
            </a>
            <div class="dropdown-divider"></div>
            
            <!-- Reports -->
            <a class="dropdown-item" href="javascript:void(0)" (click)="downloadFIFOReportASM1()">
              <i class="material-icons">assessment</i>
              Download FIFO Report ASM1
            </a>
            <div class="dropdown-divider"></div>
            
            <!-- Data Management -->
            <a class="dropdown-item" href="javascript:void(0)" (click)="loadInventoryFromFirebase()">
              <i class="material-icons">cloud_download</i>
              Load to√†n b·ªô inventory
            </a>
            <a class="dropdown-item text-warning" href="javascript:void(0)" (click)="consolidateAllInventory()">
              <i class="material-icons">merge_type</i>
              G·ªôp d√≤ng tr√πng l·∫∑p
            </a>
            <div class="dropdown-divider"></div>
            
            <!-- Maintenance -->
            <a class="dropdown-item text-danger" href="javascript:void(0)" (click)="fixProblematicBatchNumbers()">
              <i class="material-icons">build</i>
              S·ª≠a batchNumber l·ªói
            </a>
          </div>
        </div>
        
        <!-- Desktop Stats Boxes -->
        <div class="desktop-stats-section">
          <!-- Negative Stock Counter Box -->
        <div class="negative-stock-counter-box" 
             [class.has-negative]="(negativeStockCount$ | async) > 0"
             [title]="(negativeStockCount$ | async) > 0 ? 'C√≥ ' + (negativeStockCount$ | async) + ' m√£ h√†ng c√≥ t·ªìn kho √¢m. T·ªìn kho √¢m ƒë∆∞·ª£c ch·∫•p nh·∫≠n v√† hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß.' : 'Kh√¥ng c√≥ m√£ h√†ng n√†o c√≥ t·ªìn kho √¢m'">
          <i class="material-icons">{{ (negativeStockCount$ | async) > 0 ? 'warning' : 'check_circle' }}</i>
          <span>{{ (negativeStockCount$ | async) > 0 ? 'M√£ √¢m: ' + (negativeStockCount$ | async) : 'T·ªìn kho OK' }}</span>
        </div>
        
        <!-- Total Counter Box - Clickable to filter negative stock -->
        <div class="total-counter-box clickable" 
             (click)="toggleNegativeStockFilter()"
             [class.active-filter]="showOnlyNegativeStock"
             [title]="showOnlyNegativeStock ? 'Click ƒë·ªÉ hi·ªÉn th·ªã t·∫•t c·∫£ m√£ h√†ng' : 'Click ƒë·ªÉ ch·ªâ hi·ªÉn th·ªã m√£ h√†ng c√≥ t·ªìn kho √¢m'">
          <i class="material-icons">inventory_2</i>
          <span>T·ªïng: {{ filteredInventory.length }} m√£</span>
        </div>
        
          <!-- Total Stock Counter Box -->
        <div class="total-stock-counter-box" 
             [title]="'T·ªïng s·ªë t·ªìn kho c·ªßa ' + filteredInventory.length + ' m√£ h√†ng ƒëang ƒë∆∞·ª£c search'">
          <i class="material-icons">assessment</i>
          <span>T·ªïng t·ªìn: {{ (totalStockCount$ | async) | number:'1.0-0' }}</span>
        </div>
        </div>
        
        

        
        <!-- Mobile Search Section - Always visible on mobile -->
        <div class="mobile-search-section">
          <!-- Search Type Selector -->
          <div class="search-type-selector">
            <div class="dropdown">
              <button class="search-type-dropdown" 
                      type="button" 
                      data-toggle="dropdown" 
                      aria-haspopup="true" 
                      aria-expanded="false">
                <i class="material-icons">{{searchType === 'material' ? 'inventory' : searchType === 'po' ? 'receipt' : 'place'}}</i>
                {{searchType === 'material' ? 'M√£' : searchType === 'po' ? 'PO' : 'V·ªã tr√≠'}}
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item" href="javascript:void(0)" (click)="changeSearchType('material')">
                  <i class="material-icons">inventory</i>
                  M√£
                </a>
                <a class="dropdown-item" href="javascript:void(0)" (click)="changeSearchType('po')">
                  <i class="material-icons">receipt</i>
                  PO
                </a>
                <a class="dropdown-item" href="javascript:void(0)" (click)="changeSearchType('location')">
                  <i class="material-icons">place</i>
                  V·ªã tr√≠
                </a>
              </div>
            </div>
          </div>
          
          <!-- Search Box -->
          <div class="search-box">
            <input type="text"
                   [placeholder]="isLoading ? 'üîç ƒêang t·∫£i...' : 'Nh·∫≠p ƒë·ªÉ t√¨m ki·∫øm'"
                   [(ngModel)]="searchTerm"
                   (input)="onSearchInput($event)"
                   (keyup)="onSearchKeyUp($event)"
                   class="search-input"
                   [disabled]="isLoading">
            
            <!-- Clear search button -->
            <button class="clear-search-btn" 
                    *ngIf="searchTerm" 
                    (click)="clearSearch()" 
                    title="X√≥a t√¨m ki·∫øm">
              <i class="material-icons">clear</i>
          </button>
            
            <!-- Search warning -->
            <div class="search-warning" *ngIf="searchTerm && searchTerm.length < 3">
              <i class="material-icons">info</i>
              C·∫ßn √≠t nh·∫•t 3 k√Ω t·ª±
            </div>
          </div>
        </div>
        
        <!-- Mobile Stats Section - Individual boxes on mobile -->
        <div class="mobile-stats-section">
          <!-- Negative Stock Counter Box -->
          <div class="negative-stock-counter-box" 
               [class.has-negative]="(negativeStockCount$ | async) > 0"
               [title]="(negativeStockCount$ | async) > 0 ? 'C√≥ ' + (negativeStockCount$ | async) + ' m√£ h√†ng c√≥ t·ªìn kho √¢m. T·ªìn kho √¢m ƒë∆∞·ª£c ch·∫•p nh·∫≠n v√† hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß.' : 'Kh√¥ng c√≥ m√£ h√†ng n√†o c√≥ t·ªìn kho √¢m'">
            <i class="material-icons">{{ (negativeStockCount$ | async) > 0 ? 'warning' : 'check_circle' }}</i>
            <span>{{ (negativeStockCount$ | async) > 0 ? 'M√£ √¢m: ' + (negativeStockCount$ | async) : 'T·ªìn kho OK' }}</span>
          </div>
          
          <!-- Total Counter Box - Clickable to filter negative stock -->
          <div class="total-counter-box clickable" 
               (click)="toggleNegativeStockFilter()"
               [class.active-filter]="showOnlyNegativeStock"
               [title]="showOnlyNegativeStock ? 'Click ƒë·ªÉ hi·ªÉn th·ªã t·∫•t c·∫£ m√£ h√†ng' : 'Click ƒë·ªÉ ch·ªâ hi·ªÉn th·ªã m√£ h√†ng c√≥ t·ªìn kho √¢m'">
            <i class="material-icons">inventory_2</i>
            <span>T·ªïng: {{ filteredInventory.length }} m√£</span>
          </div>
          
          <!-- Total Stock Counter Box -->
          <div class="total-stock-counter-box" 
               [title]="'T·ªïng s·ªë t·ªìn kho c·ªßa ' + filteredInventory.length + ' m√£ h√†ng ƒëang ƒë∆∞·ª£c search'">
            <i class="material-icons">assessment</i>
            <span>T·ªïng t·ªìn: {{ (totalStockCount$ | async) | number:'1.0-0' }}</span>
          </div>
        </div>
        
        <!-- Desktop Search Section -->
        <div class="desktop-search-section">
        <!-- Search Type Selector -->
        <div class="search-type-selector">
          <div class="dropdown">
            <button class="search-type-dropdown" 
                    type="button" 
                    data-toggle="dropdown" 
                    aria-haspopup="true" 
                    aria-expanded="false">
              <i class="material-icons">{{searchType === 'material' ? 'inventory' : searchType === 'po' ? 'receipt' : 'place'}}</i>
              {{searchType === 'material' ? 'M√£' : searchType === 'po' ? 'PO' : 'V·ªã tr√≠'}}
            </button>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="javascript:void(0)" (click)="changeSearchType('material')">
                <i class="material-icons">inventory</i>
                M√£
              </a>
              <a class="dropdown-item" href="javascript:void(0)" (click)="changeSearchType('po')">
                <i class="material-icons">receipt</i>
                PO
              </a>
              <a class="dropdown-item" href="javascript:void(0)" (click)="changeSearchType('location')">
                <i class="material-icons">place</i>
                V·ªã tr√≠
              </a>
            </div>
          </div>
        </div>
        
        <!-- Search Box -->
        <div class="search-box">
          <input type="text"
                 [placeholder]="isLoading ? 'üîç ƒêang t·∫£i...' : 'Nh·∫≠p ƒë·ªÉ t√¨m ki·∫øm'"
                 [(ngModel)]="searchTerm"
                 (input)="onSearchInput($event)"
                 (keyup)="onSearchKeyUp($event)"
                 class="search-input"
                 [disabled]="isLoading">
          
          <!-- Clear search button -->
          <button class="clear-search-btn" 
                  *ngIf="searchTerm" 
                  (click)="clearSearch()" 
                  title="X√≥a t√¨m ki·∫øm">
            <i class="material-icons">clear</i>
          </button>
          
          <!-- Search warning -->
          <div class="search-warning" *ngIf="searchTerm && searchTerm.length < 3">
            <i class="material-icons">info</i>
            C·∫ßn √≠t nh·∫•t 3 k√Ω t·ª±
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="reset-btn" (click)="resetZeroStock()" title="X√≥a h√†ng c√≥ t·ªìn kho = 0">
            <i class="material-icons">restart_alt</i>
            Reset
          </button>
        </div>
        
        <!-- Catalog Ready Icon -->
        <div class="catalog-ready-icon" *ngIf="!isCatalogLoading && catalogLoaded">
          <i class="material-icons">check_circle</i>
        </div>
      </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading-container" *ngIf="isLoading">
      <div class="loading-spinner">
        <i class="material-icons rotating">sync</i>
        <span>ƒêang t·∫£i d·ªØ li·ªáu ASM1...</span>
        <!-- üöÄ OPTIMIZATION: Add progress bar for search -->
        <div class="search-progress" *ngIf="isSearching">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="searchProgress"></div>
          </div>
          <span class="progress-text">{{searchProgress}}%</span>
        </div>
      </div>
    </div>



    <!-- Mobile Card View -->
    <div class="mobile-cards-container" *ngIf="!isLoading">
      <div class="mobile-card" *ngFor="let material of filteredInventory; trackBy: trackByFn; let i = index" 
           [class.duplicate-card]="material.isDuplicate"
           [class.iqc-card]="isIQCLocation(material.location)">
        
        <!-- Card Header -->
        <div class="card-header">
          <div class="material-info">
            <h3 class="material-code">{{material.materialCode}}</h3>
            <p class="po-number">PO: {{material.poNumber}}</p>
          </div>
          <div class="card-actions">
            <button class="qr-btn" 
                    (click)="printQRCode(material)"
                    [disabled]="!isRollsOrBagsValid(material)"
                    [title]="!isRollsOrBagsValid(material) ? 'Kh√¥ng th·ªÉ in QR - thi·∫øu Rolls/Bags' : 'T·∫°o QR code'">
              <i class="material-icons">qr_code</i>
            </button>
          </div>
        </div>
        
        <!-- Card Content -->
        <div class="card-content">
          <div class="info-row">
            <span class="label">IMD:</span>
            <span class="value">{{getDisplayIMD(material)}}</span>
          </div>
          
          <div class="info-row">
            <span class="label">T·ªìn ƒë·∫ßu:</span>
            <input type="number" 
                   class="mobile-input" 
                   [ngModel]="material.openingStock || ''"
                   (ngModelChange)="material.openingStock = $event === '' ? null : +$event" 
                   (change)="updateOpeningStock(material)" 
                   min="0" 
                   step="0.1" 
                   placeholder="Nh·∫≠p t·ªìn ƒë·∫ßu">
          </div>
          
          <div class="info-row">
            <span class="label">NK:</span>
            <span class="value">{{formatNumber(material.quantity)}}</span>
          </div>
          
          <div class="info-row">
            <span class="label">ƒê√£ xu·∫•t:</span>
            <span class="value">{{formatNumber(material.exported || 0)}}</span>
          </div>
          
          <div class="info-row">
            <span class="label">XT:</span>
            <input type="number" 
                   class="mobile-input" 
                   [(ngModel)]="material.xt" 
                   (change)="updateXT(material)" 
                   min="0" 
                   step="0.1" 
                   placeholder="Nh·∫≠p XT">
          </div>
          
          <div class="info-row">
            <span class="label">T·ªìn kho:</span>
            <span class="value" [class.negative-stock]="calculateCurrentStock(material) < 0">
              {{formatNumber(calculateCurrentStock(material))}}
            </span>
          </div>
          
          <div class="info-row location-row">
            <span class="label">V·ªã tr√≠:</span>
            <div style="display: flex; align-items: center; gap: 8px;">
              <input type="text" 
                     class="mobile-input location-input" 
                     [(ngModel)]="material.location" 
                     (change)="updateLocation(material)"
                     (blur)="onLocationChange(material)"
                     placeholder="Nh·∫≠p v·ªã tr√≠">
              <button class="scan-btn" 
                      (click)="scanLocationQR(material)"
                      title="Scan QR ƒë·ªÉ thay ƒë·ªïi v·ªã tr√≠">
                <i class="material-icons">qr_code_scanner</i>
              </button>
            </div>
          </div>
          
          <div class="info-row">
            <span class="label">QTY BAG:</span>
            <input type="number" 
                   class="mobile-input" 
                   [(ngModel)]="material.rollsOrBags" 
                   (change)="updateRollsOrBags(material)"
                   min="0" 
                   step="1"
                   [placeholder]="getStandardPacking(material.materialCode) || '0'">
          </div>
          
          <div class="info-row">
            <span class="label">Standard Packing:</span>
            <span class="value">{{ getStandardPacking(material.materialCode) }}</span>
          </div>
        </div>
        
        <!-- Card Footer -->
        <div class="card-footer">
          <div class="status-badge" [class]="getStatusClass(material)">
            {{ getStatusText(material) }}
          </div>
          <button class="delete-btn" 
                  *ngIf="canDelete"
                  (click)="deleteInventoryItem(material)"
                  title="X√≥a item n√†y">
            <i class="material-icons">delete</i>
          </button>
        </div>
      </div>
    </div>

    <!-- Desktop Table Container -->
    <div class="table-container desktop-only" *ngIf="!isLoading">
      <!-- Table -->
      <table class="excel-table">
        <thead>
          <tr>
            <th>QR</th>
            <th>QTY BAG</th>
            <th>STT</th>

            <th>M√£ h√†ng</th>
            <th>PO</th>
                            <th>IMD</th>
            <th>T·ªìn ƒë·∫ßu</th>
            <th>NK</th>
            <th title="S·ªë l∆∞·ª£ng ƒë√£ xu·∫•t t·ª´ RM1 outbound (t·ª± ƒë·ªông c·∫≠p nh·∫≠t)">ƒê√£ xu·∫•t</th>
            <th title="S·ªë l∆∞·ª£ng c·∫ßn xu·∫•t (nh·∫≠p tay)">XT</th>
            <th title="T·ªìn kho = T·ªìn ƒë·∫ßu + NK - ƒê√£ xu·∫•t - XT">T·ªìn kho</th>
            <th>V·ªã tr√≠</th>
            <th>Change</th>
            <th>Lo·∫°i H√¨nh</th>

            <th>L∆∞u √Ω</th>
            <th>Standard Packing</th>
            <th>Tr·∫°ng th√°i</th>
            <th>X√≥a</th>
            <th>Factory</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let material of filteredInventory; trackBy: trackByFn; let i = index" 
              [class.duplicate-row]="material.isDuplicate"
              [class.iqc-row]="isIQCLocation(material.location)">
            <td class="qr-cell">
              <button class="qr-btn" 
                      (click)="printQRCode(material)"
                      [disabled]="!isRollsOrBagsValid(material)"
                      [title]="!isRollsOrBagsValid(material) ? 'Kh√¥ng th·ªÉ in QR - thi·∫øu Rolls/Bags' : 'T·∫°o QR code'">
                <i class="material-icons">qr_code</i>
              </button>
            </td>
            <td class="rolls-bags-cell">
              <input type="number" 
                     class="editable-input" 
                     [(ngModel)]="material.rollsOrBags" 
                     (change)="updateRollsOrBags(material)"
                     (blur)="updateRollsOrBags(material)"
                     (keyup.enter)="updateRollsOrBags(material)"
                     min="0" 
                     step="1"
                     [placeholder]="getStandardPacking(material.materialCode) || '0'"
                     [title]="'QTY BAG (m·∫∑c ƒë·ªãnh t·ª´ Standard Packing: ' + (getStandardPacking(material.materialCode) || 'N/A') + ')'">
            </td>
            <td class="row-header">{{i + 1}}</td>

            <td class="code-cell material-code-cell" 
                [class.duplicate-cell]="material.isDuplicate"
                [class.duplicate-code]="material.isDuplicate"
                [class.normal-code]="!material.isDuplicate">
              {{material.materialCode}}
            </td>
            <td class="po-cell" [class.duplicate-cell]="material.isDuplicate">{{material.poNumber}}</td>
            <td class="date-cell" [class.duplicate-cell]="material.isDuplicate">
              {{getDisplayIMD(material)}}
            </td>
            <td class="number-cell" [class.duplicate-cell]="material.isDuplicate">
              <span *ngIf="!material.isEditingOpeningStock" 
                    class="display-value" 
                    (click)="startEditingOpeningStock(material)"
                    [title]="'Click ƒë·ªÉ s·ª≠a t·ªìn ƒë·∫ßu: ' + formatNumber(material.openingStock || 0)">
                {{formatNumber(material.openingStock || 0)}}
              </span>
              <input *ngIf="material.isEditingOpeningStock"
                     type="number" 
                     class="opening-stock-input" 
                     [ngModel]="material.openingStock || ''"
                     (ngModelChange)="material.openingStock = $event === '' ? null : +$event" 
                     (blur)="finishEditingOpeningStock(material)"
                     (keyup.enter)="finishEditingOpeningStock(material)"
                     (keyup.escape)="cancelEditingOpeningStock(material)"
                     min="0" 
                     step="0.1" 
                     placeholder="Nh·∫≠p t·ªìn ƒë·∫ßu">
            </td>
            <td class="number-cell" [class.duplicate-cell]="material.isDuplicate">{{formatNumber(material.quantity)}}</td>
            <!-- C·ªôt "ƒê√£ xu·∫•t" - C√≥ th·ªÉ edit khi m·ªü kh√≥a -->
            <td class="number-cell" 
                [class.readonly-cell]="!isExportColumnUnlocked"
                [class.editable-export-cell]="isExportColumnUnlocked"
                [title]="isExportColumnUnlocked ? 'Click ƒë·ªÉ s·ª≠a s·ªë l∆∞·ª£ng ƒë√£ xu·∫•t' : 'S·ªë l∆∞·ª£ng ƒë√£ xu·∫•t t·ª´ RM1 outbound: ' + (material.exported || 0) + '\nT·ª± ƒë·ªông c·∫≠p nh·∫≠t v√† l∆∞u tr·ªØ vƒ©nh vi·ªÖn\nK·ªÉ c·∫£ khi x√≥a d√≤ng xu·∫•t ·ªü outbound c≈©ng kh√¥ng ·∫£nh h∆∞·ªüng'">
              <ng-container *ngIf="!isExportColumnUnlocked">
                {{formatNumber(material.exported || 0)}}
              </ng-container>
              <ng-container *ngIf="isExportColumnUnlocked">
                <input type="number" 
                       class="editable-input" 
                       [(ngModel)]="material.exported"
                       (change)="updateExportedAmount(material)"
                       (blur)="updateExportedAmount(material)"
                       (keyup.enter)="updateExportedAmount(material)"
                       min="0" 
                       step="0.1"
                       placeholder="0">
              </ng-container>
            </td>
                        <!-- C·ªôt "XT" - S·ªë l∆∞·ª£ng c·∫ßn xu·∫•t (nh·∫≠p tay) -->
            <td class="number-cell xt-column">
              <span *ngIf="!material.isEditingXT" 
                    class="display-value" 
                    (click)="startEditingXT(material)"
                    [title]="'Click ƒë·ªÉ s·ª≠a XT: ' + formatNumber(material.xt || 0)">
                {{formatNumber(material.xt || 0)}}
              </span>
              <input *ngIf="material.isEditingXT"
                     type="number" 
                     class="editable-cell" 
                     [ngModel]="material.xt || ''"
                     (ngModelChange)="material.xt = $event === '' ? null : +$event" 
                     (blur)="finishEditingXT(material)"
                     (keyup.enter)="finishEditingXT(material)"
                     (keyup.escape)="cancelEditingXT(material)"
                     min="0" 
                     step="0.1" 
                     placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng XT">
            </td>
            <td class="number-cell" [class.duplicate-cell]="material.isDuplicate" 
                [class.negative-stock-cell]="calculateCurrentStock(material) < 0"
                [title]="'L∆∞·ª£ng nh·∫≠p: ' + (material.quantity || 0) + ' - Xu·∫•t: ' + (material.exported || 0) + ' - XT: ' + (material.xt || 0) + ' = ' + calculateCurrentStock(material)">
              {{formatNumber(calculateCurrentStock(material))}}
            </td>
            <td class="location-cell" [class.iqc-location]="isIQCLocation(material.location)">
              <input type="text" 
                     class="editable-cell location-input" 
                     [(ngModel)]="material.location" 
                     (change)="updateLocation(material)"
                     (blur)="onLocationChange(material)">
            </td>
            <td class="change-cell">
              <button class="scan-change-btn" 
                      (click)="scanLocationQR(material)"
                      title="Scan QR ƒë·ªÉ thay ƒë·ªïi v·ªã tr√≠">
                Scan
              </button>
            </td>
            <td class="type-cell">
              <input type="text" class="editable-cell" [(ngModel)]="material.type" (change)="updateType(material)">
            </td>

            <td class="notes-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.remarks" 
                     (change)="updateRemarks(material)"
                     placeholder="Nh·∫≠p l∆∞u √Ω..."
                     title="L∆∞u √Ω t·ª´ inbound">
            </td>
            <td class="standard-packing-cell">
              <span class="standard-packing-value">{{ getStandardPacking(material.materialCode) }}</span>
            </td>
            <td class="status-cell">
              <span class="badge" 
                    [class]="getStatusClass(material)">
                {{ getStatusText(material) }}
              </span>
            </td>
            <td class="delete-cell">
              <button class="delete-btn" 
                      *ngIf="canDelete"
                      (click)="deleteInventoryItem(material)"
                      title="X√≥a item n√†y kh·ªèi ASM1 Inventory">
                <i class="material-icons">delete</i>
              </button>
            </td>
            <td class="factory-cell factory-asm1">
              ASM1
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State - Search First Approach -->
      <div class="empty-state" *ngIf="!searchTerm && filteredInventory.length === 0 && !isLoading">
        <div class="empty-state-content">
          <i class="material-icons">search</i>
          <h3>üîç T√¨m ki·∫øm ASM1 Inventory</h3>
          <p>Nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ t√¨m ki·∫øm materials trong ASM1 inventory</p>
          
          <!-- Search Suggestions -->
          <div class="search-suggestions">
            <h5>üí° G·ª£i √Ω t√¨m ki·∫øm:</h5>
            <div class="suggestion-tags">
              <span class="suggestion-tag" (click)="searchTerm = 'B018694'; onSearchInput({target: {value: 'B018694'}})">B018694</span>
              <span class="suggestion-tag" (click)="searchTerm = 'PO123'; onSearchInput({target: {value: 'PO123'}})">PO123</span>
              <span class="suggestion-tag" (click)="searchTerm = 'Location A'; onSearchInput({target: {value: 'Location A'}})">Location A</span>
            </div>
          </div>
          
          <!-- Quick Stats -->
          <div class="quick-stats">
            <div class="stat-item">
              <i class="material-icons">factory</i>
              <span>ASM1 Factory</span>
            </div>
            <div class="stat-item">
              <i class="material-icons">inventory</i>
              <span>Real-time Search</span>
            </div>
            <div class="stat-item">
              <i class="material-icons">speed</i>
              <span>Fast Loading</span>
            </div>
          </div>
        </div>
      </div>

      <!-- No Search Results -->
      <div class="no-results" *ngIf="searchTerm && filteredInventory.length === 0 && !isLoading">
        <div class="no-results-content">
          <i class="material-icons">search_off</i>
          <h4>üîç Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</h4>
          <p>Kh√¥ng t√¨m th·∫•y materials n√†o cho "<strong>{{searchTerm}}</strong>" trong ASM1</p>
          
          <!-- Search Tips -->
          <div class="search-tips">
            <h6>üí° M·∫πo t√¨m ki·∫øm:</h6>
            <ul>
              <li>Ki·ªÉm tra ch√≠nh t·∫£</li>
              <li>Th·ª≠ t√¨m ki·∫øm v·ªõi √≠t k√Ω t·ª± h∆°n</li>
              <li>Ki·ªÉm tra factory filter (ASM1)</li>
              <li>Th·ª≠ t√¨m ki·∫øm theo PO number</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="loading-content">
          <i class="material-icons rotating">sync</i>
          <h4>üîç ƒêang t√¨m ki·∫øm...</h4>
          <p>T√¨m ki·∫øm "<strong>{{searchTerm}}</strong>" trong ASM1 inventory</p>
        </div>
      </div>
    </div>
  </div>
</div>
