<div class="main-content">
  <!-- Excel-like Container -->
  <div class="excel-container">
    <!-- Report Title -->
    <div class="excel-header">
      <h4>üõ°Ô∏è SAFETY INVENTORY</h4>
      <div class="scan-mode-indicator" *ngIf="isScanMode">
        <i class="material-icons">qr_code_scanner</i>
        <span>ƒêang scan cho {{scanFactory}}</span>
      </div>
    </div>
    
    <!-- Excel Actions -->
    <div class="excel-actions">
      <div class="action-controls-horizontal">
        <!-- More Button with Dropdown -->
        <div class="dropdown">
          <button class="more-btn" (click)="toggleDropdown($event)">
            <i class="material-icons">more_vert</i>
            More
          </button>
          <div class="dropdown-menu" [class.show]="isDropdownOpen">
            <a class="dropdown-item" href="javascript:void(0)" (click)="exportToExcel()">
              <i class="material-icons">file_download</i>
              Export to Excel
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="javascript:void(0)" (click)="downloadSampleTemplate()">
              <i class="material-icons">description</i>
              Download Template
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="javascript:void(0)" (click)="importSafetyLevels()">
              <i class="material-icons">file_upload</i>
              Import Safety Levels
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="javascript:void(0)" (click)="initializeSampleData()">
              <i class="material-icons">add_circle</i>
              Initialize Sample Data
            </a>
          </div>
        </div>
        
        <!-- Total Counter Box -->
        <div class="total-counter-box">
          <i class="material-icons">inventory_2</i>
          <span>T·ªïng: {{ filteredMaterials.length }} m√£</span>
        </div>
        
        <!-- Factory Filter -->
        <div class="factory-filter">
          <select [(ngModel)]="selectedFactory" (change)="onFactoryChange()" class="factory-select">
            <option *ngFor="let factory of availableFactories" [value]="factory">
              {{ factory }}
            </option>
          </select>
        </div>
        
        <!-- Search Type Selector -->
        <div class="search-type-selector">
          <div class="dropdown">
            <button class="search-type-dropdown" 
                    type="button" 
                    data-toggle="dropdown" 
                    aria-haspopup="true" 
                    aria-expanded="false">
              <i class="material-icons">{{searchType === 'material' ? 'inventory' : 'factory'}}</i>
              {{searchType === 'material' ? 'M√£' : 'Factory'}}
            </button>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="javascript:void(0)" (click)="changeSearchType('material')">
                <i class="material-icons">inventory</i>
                M√£
              </a>
              <a class="dropdown-item" href="javascript:void(0)" (click)="changeSearchType('factory')">
                <i class="material-icons">factory</i>
                Factory
              </a>
            </div>
          </div>
        </div>
        
        <!-- Search Box -->
        <div class="search-box">
          <input type="text"
                 [placeholder]="isLoading ? 'üîç ƒêang t·∫£i...' : 'Nh·∫≠p ƒë·ªÉ t√¨m ki·∫øm'"
                 [(ngModel)]="searchTerm"
                 (input)="onSearchInput($event)"
                 (keyup)="onSearchKeyUp($event)"
                 class="search-input"
                 [disabled]="isLoading">
          
          <!-- Clear search button -->
          <button class="clear-search-btn" 
                  *ngIf="searchTerm" 
                  (click)="clearSearch()" 
                  title="X√≥a t√¨m ki·∫øm">
            <i class="material-icons">clear</i>
          </button>
          
          <!-- Search warning -->
          <div class="search-warning" *ngIf="searchTerm && searchTerm.length < 3">
            <i class="material-icons">info</i>
            C·∫ßn √≠t nh·∫•t 3 k√Ω t·ª±
          </div>
        </div>
        
                 <!-- Action Buttons -->
         <div class="action-buttons">
           <!-- Scan Mode Buttons -->
           <div class="scan-buttons" *ngIf="!isScanMode">
             <button class="scan-btn scan-asm1" (click)="startScanMode('ASM1')" title="B·∫Øt ƒë·∫ßu scan cho ASM1">
               <i class="material-icons">qr_code_scanner</i>
               ASM1
             </button>
             <button class="scan-btn scan-asm2" (click)="startScanMode('ASM2')" title="B·∫Øt ƒë·∫ßu scan cho ASM2">
               <i class="material-icons">qr_code_scanner</i>
               ASM2
             </button>
           </div>
           
           <!-- Stop Scan Button -->
           <div class="scan-buttons" *ngIf="isScanMode">
             <button class="stop-scan-btn" (click)="stopScanMode()" title="D·ª´ng ch·∫ø ƒë·ªô scan">
               <i class="material-icons">stop</i>
               D·ª´ng Scan ({{scanFactory}})
             </button>
           </div>
           
           
            
            <button class="refresh-btn" (click)="refreshData()" title="L√†m m·ªõi d·ªØ li·ªáu Safety">
              <i class="material-icons">refresh</i>
              Refresh
            </button>
         </div>
         
         <!-- Import Progress Indicator -->
         <div class="import-progress" *ngIf="isImporting">
           <div class="progress-bar">
             <div class="progress-fill" [style.width.%]="importProgress"></div>
           </div>
           <span class="progress-text">ƒêang import: {{importProgress}}%</span>
         </div>
        
        <!-- Scan Status and Test Input -->
        <div class="scan-status" *ngIf="isScanMode">
                     <div class="scan-info">
             <i class="material-icons">qr_code_scanner</i>
             <span>ƒêang scan cho <strong>{{scanFactory}}</strong> - ƒê·ªãnh d·∫°ng tem: <code>Rxxxxxx yyyy</code> ho·∫∑c <code>Bxxxxxx yyyy</code></span>
           </div>
          
                     <div class="scan-instructions">
             <p><strong>H∆∞·ªõng d·∫´n:</strong></p>
             <ul>
               <li>B·∫•m n√∫t <strong>ASM1</strong> ho·∫∑c <strong>ASM2</strong> ƒë·ªÉ b·∫Øt ƒë·∫ßu scan</li>
               <li>Scan tem c√≥ ƒë·ªãnh d·∫°ng: <code>RB018694 150</code> ho·∫∑c <code>R123456 200</code></li>
               <li>Trong ƒë√≥: <code>B018694</code> ho·∫∑c <code>R123456</code> l√† m√£ h√†ng (7 k√Ω t·ª±), <code>150</code> ho·∫∑c <code>200</code> l√† s·ªë l∆∞·ª£ng</li>
               <li>M√£ h√†ng b·∫Øt ƒë·∫ßu b·∫±ng <strong>R</strong> ho·∫∑c <strong>B</strong> + 6 s·ªë (t·ªïng 7 k√Ω t·ª±)</li>
               <li>S·ªë l∆∞·ª£ng s·∫Ω ƒë∆∞·ª£c c·ªông d·ªìn n·∫øu m√£ h√†ng ƒë√£ t·ªìn t·∫°i</li>
               <li>C·ªôt Safety c√≥ th·ªÉ ch·ªânh s·ª≠a b·∫±ng c√°ch click v√†o dropdown</li>
             </ul>
           </div>
          
                     <!-- Test input for development -->
           <div class="test-scan-input">
             <input type="text" 
                    placeholder="Nh·∫≠p tem ƒë·ªÉ test (VD: RB018694 150 ho·∫∑c R123456 200)" 
                    class="test-input"
                    (keyup.enter)="processScannedData($event.target.value); $event.target.value = ''">
             <button class="test-scan-btn" 
                     (click)="testScan()">
               Test Scan
             </button>
           </div>
        </div>
      </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading-container" *ngIf="isLoading">
      <div class="loading-spinner">
        <i class="material-icons rotating">sync</i>
        <span>ƒêang t·∫£i d·ªØ li·ªáu Safety...</span>
      </div>
    </div>

    <!-- Table Container -->
    <div class="table-container" *ngIf="!isLoading">
             <!-- Table -->
       <table class="excel-table">
         <thead>
           <tr>
             <th>Factory</th>
             <th>Ng√†y Scan</th>
             <th>M√£ h√†ng</th>
             <th>S·ªë L∆∞·ª£ng Th·ª±c T·∫ø</th>
             <th>Safety</th>
             <th>T√¨nh Tr·∫°ng</th>
             <th>X√≥a</th>
           </tr>
         </thead>
         <tbody>
           <tr *ngFor="let material of filteredMaterials; trackBy: trackByFn; let i = index">
             <td class="factory-cell factory-{{material.factory.toLowerCase()}}">
               {{material.factory}}
             </td>
             <td class="date-cell">
               {{formatDate(material.scanDate)}}
             </td>
             <td class="code-cell material-code-cell">
               {{material.materialCode}}
             </td>
             <td class="number-cell">
               {{material.actualQuantity}}
             </td>
             <td class="safety-cell">
               <select class="safety-select" 
                       [value]="material.safety"
                       (change)="updateSafety(material, $event.target.value)">
                 <option *ngFor="let category of safetyCategories" 
                         [value]="category.value">
                   {{category.label}}
                 </option>
               </select>
             </td>
             <td class="status-cell">
               <span class="badge" [class]="getStatusClass(material)">
                 {{ getStatusText(material) }}
               </span>
             </td>
             <td class="delete-cell">
               <button class="delete-btn" 
                       (click)="deleteMaterial(material)"
                       title="X√≥a {{material.materialCode}}">
                 <i class="material-icons">delete</i>
               </button>
             </td>
           </tr>
         </tbody>
       </table>

      <!-- Empty State - Search First Approach -->
      <div class="empty-state" *ngIf="!searchTerm && filteredMaterials.length === 0 && !isLoading">
        <div class="empty-state-content">
          <i class="material-icons">search</i>
          <h3>üîç T√¨m ki·∫øm Safety Inventory</h3>
          <p>Nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ t√¨m ki·∫øm materials trong Safety inventory</p>
          
                     <!-- Search Suggestions -->
           <div class="search-suggestions">
             <h5>üí° G·ª£i √Ω t√¨m ki·∫øm:</h5>
             <div class="suggestion-tags">
               <span class="suggestion-tag" (click)="searchTerm = 'B018694'; onSearchInput({target: {value: 'B018694'}})">B018694</span>
               <span class="suggestion-tag" (click)="searchTerm = 'R123456'; onSearchInput({target: {value: 'R123456'}})">R123456</span>
               <span class="suggestion-tag" (click)="searchTerm = 'ASM1'; onSearchInput({target: {value: 'ASM1'}})">ASM1</span>
               <span class="suggestion-tag" (click)="searchTerm = 'Safety'; onSearchInput({target: {value: 'Safety'}})">Safety</span>
             </div>
           </div>
          
          <!-- Quick Stats -->
          <div class="quick-stats">
            <div class="stat-item">
              <i class="material-icons">factory</i>
              <span>Multi Factory</span>
            </div>
            <div class="stat-item">
              <i class="material-icons">inventory</i>
              <span>Real-time Search</span>
            </div>
            <div class="stat-item">
              <i class="material-icons">speed</i>
              <span>Fast Loading</span>
            </div>
          </div>
        </div>
      </div>

      <!-- No Search Results -->
      <div class="no-results" *ngIf="searchTerm && filteredMaterials.length === 0 && !isLoading">
        <div class="no-results-content">
          <i class="material-icons">search_off</i>
          <h4>üîç Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</h4>
          <p>Kh√¥ng t√¨m th·∫•y materials n√†o cho "<strong>{{searchTerm}}</strong>" trong Safety inventory</p>
          
          <!-- Search Tips -->
          <div class="search-tips">
            <h6>üí° M·∫πo t√¨m ki·∫øm:</h6>
            <ul>
              <li>Ki·ªÉm tra ch√≠nh t·∫£</li>
              <li>Th·ª≠ t√¨m ki·∫øm v·ªõi √≠t k√Ω t·ª± h∆°n</li>
              <li>Ki·ªÉm tra factory filter</li>
              <li>Th·ª≠ t√¨m ki·∫øm theo material code</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="loading-content">
          <i class="material-icons rotating">sync</i>
          <h4>üîç ƒêang t√¨m ki·∫øm...</h4>
          <p>T√¨m ki·∫øm "<strong>{{searchTerm}}</strong>" trong Safety inventory</p>
        </div>
      </div>
    </div>
  </div>
</div>
