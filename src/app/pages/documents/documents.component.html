<div class="main-content">
  <div class="container-fluid documents-container" [class.embedded]="selectedDocumentUrl">

    <!-- Document List View -->
    <div *ngIf="!selectedDocumentUrl && !showDailyChecklist">
      <!-- Row for Checklists -->
      <div class="row checklist-row">
        <div *ngFor="let doc of documentList" class="col-md-auto checklist-card">
          <div class="card">
            <div class="card-body text-center">
              <h5 class="card-title">{{ doc.title }}</h5>
              <button (click)="selectDocument(doc)" class="btn btn-info">OPEN</button>
            </div>
          </div>
        </div>
        
        <!-- Daily Checklist Shelves Button -->
        <div class="col-md-auto checklist-card">
          <div class="card">
            <div class="card-body text-center">
                              <h5 class="card-title">üìã Daily Checklist Shelves</h5>
              <button (click)="openDailyChecklist()" class="btn btn-primary">
                <i class="material-icons">checklist</i>
                OPEN
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Here you can add another row for other documents if needed -->

    </div>

    <!-- Embedded Document View -->
    <div *ngIf="selectedDocumentUrl" class="embedded-view">
      <div class="toolbar">
        <button (click)="closeDocument()" class="btn btn-white btn-round btn-just-icon mr-3">
          <i class="material-icons">arrow_back</i>
        </button>
        <span>Ho√†n th√†nh bi·ªÉu m·∫´u v√† nh·∫•n n√∫t quay l·∫°i.</span>
      </div>
      <div class="iframe-container">
        <iframe [src]="selectedDocumentUrl" width="100%" height="100%" frameborder="0">ƒêang t·∫£i...</iframe>
      </div>
    </div>

    <!-- Daily Checklist Shelves View -->
    <div *ngIf="showDailyChecklist" class="daily-checklist-view">
      <div class="toolbar compact-toolbar">
        <button (click)="closeDailyChecklist()" class="btn btn-white btn-round btn-just-icon mr-3">
          <i class="material-icons">arrow_back</i>
        </button>
        <span class="compact-header">Daily Checklist Shelves - Quay l·∫°i ƒë·ªÉ xem danh s√°ch t√†i li·ªáu.</span>
      </div>
      
      <div class="container">
        <div class="header">
          <h3 class="compact-title">üìã CHECKLIST K·ªÜ KHO</h3>
        </div>
        
        <div class="toolbar">
          <div class="form-inputs">
            <div class="form-group">
              <label for="nguoiKiem">Ng∆∞·ªùi ki·ªÉm:</label>
              <select id="nguoiKiem" class="form-control" [(ngModel)]="currentData.nguoiKiem">
                <option value="">Ch·ªçn ng∆∞·ªùi ki·ªÉm</option>
                <option value="Ho√†ng V≈©">Ho√†ng V≈©</option>
                <option value="H·ªØu T√¨nh">H·ªØu T√¨nh</option>
                <option value="Ho√†ng Tu·∫•n">Ho√†ng Tu·∫•n</option>
                <option value="To√†n">To√†n</option>
                <option value="H∆∞ng">H∆∞ng</option>
                <option value="Ph√∫c">Ph√∫c</option>
                <option value="T√∫">T√∫</option>
              </select>
            </div>
            <div class="form-group">
              <label for="ngayKiem">Ng√†y ki·ªÉm:</label>
              <input type="date" id="ngayKiem" class="form-control" [(ngModel)]="currentData.ngayKiem">
            </div>
          </div>
          
          <div class="toolbar-actions">
            <button class="btn btn-primary" (click)="startNewChecklist()" [disabled]="isLoading">
              <span class="loading-spinner" [class.show]="isLoading"></span>
              üìù T·∫°o m·ªõi
            </button>
            <button class="btn btn-info" (click)="toggleHistory()" [disabled]="isLoading">
              üìä {{ showHistory ? '·∫®n l·ªãch s·ª≠' : 'L·ªãch s·ª≠' }}
            </button>
            <button class="btn btn-warning" (click)="toggleCalendar()" [disabled]="isLoading">
              üìÖ {{ showCalendar ? '·∫®n l·ªãch' : 'L·ªãch th√°ng' }}
            </button>
            <button class="btn btn-success" (click)="exportData()" [disabled]="isLoading">
              üìã Xu·∫•t Excel
            </button>
          </div>
        </div>

        <div class="main-content">
          <div class="summary-cards">
            <div class="summary-card total">
              <div class="summary-number">{{ getTotalItems() }}</div>
              <div class="summary-label">T·ªïng m·ª•c</div>
            </div>
            <div class="summary-card ok">
              <div class="summary-number">{{ getCheckedItems() }}</div>
              <div class="summary-label">ƒê√£ ki·ªÉm</div>
            </div>
            <div class="summary-card ng">
              <div class="summary-number">{{ getNGItems() }}</div>
              <div class="summary-label">NG</div>
            </div>
            <div class="summary-card pending">
              <div class="summary-number">{{ getUncheckedItems() }}</div>
              <div class="summary-label">Ch∆∞a ki·ªÉm</div>
            </div>
          </div>

          <div class="checklist-section">
            <h4 class="section-title compact-section">üìã Danh m·ª•c ki·ªÉm tra</h4>
            <div class="table-container">
              <table class="checklist-table">
                <thead>
                  <tr>
                    <th>STT</th>
                    <th>Danh m·ª•c</th>
                    <th>M·ª•c ki·ªÉm tra</th>
                    <th>OK</th>
                    <th>NG</th>
                    <th>Ghi ch√∫</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of currentData.items; let i = index" [class.category-row]="item.category !== getPreviousCategory(i)">
                    <td>{{ i + 1 }}</td>
                    <td>{{ item.category }}</td>
                    <td>{{ item.item }}</td>
                    <td class="check-cell">
                      <input 
                        type="checkbox" 
                        class="checkbox-custom" 
                        [(ngModel)]="item.isOK"
                        (change)="updateItemStatus(i)">
                    </td>
                    <td class="check-cell">
                      <input 
                        type="checkbox" 
                        class="checkbox-custom checkbox-ng" 
                        [(ngModel)]="item.isNG"
                        (change)="updateItemStatus(i)">
                    </td>
                    <td>
                      <input 
                        type="text" 
                        class="notes-input" 
                        [(ngModel)]="item.notes"
                        (blur)="updateItemNotes(i)"
                        placeholder="Ghi ch√∫...">
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="history-section" *ngIf="showHistory">
            <h4 class="section-title compact-section">üìä L·ªãch s·ª≠ ki·ªÉm k√™</h4>
            <div class="table-container">
              <table class="history-table">
                <thead>
                  <tr>
                    <th>Ng√†y ki·ªÉm</th>
                    <th>K·ªá</th>
                    <th>Ng∆∞·ªùi ki·ªÉm</th>
                    <th>Ca ki·ªÉm</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>T·ªïng m·ª•c</th>
                    <th>Ho√†n th√†nh</th>
                    <th>Thao t√°c</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let record of historyData">
                    <td>{{ record.ngayKiem | date:'dd/MM/yyyy' }}</td>
                    <td>{{ record.kiemKe }}</td>
                    <td>{{ record.nguoiKiem }}</td>
                    <td>{{ record.caKiem }}</td>
                    <td>
                      <span class="status-badge" [class]="record.status">
                        {{ record.status === 'completed' ? 'Ho√†n th√†nh' : 'ƒêang th·ª±c hi·ªán' }}
                      </span>
                    </td>
                    <td>{{ record.items.length }}</td>
                    <td>{{ getCompletedCount(record.items) }}/{{ record.items.length }}</td>
                    <td>
                      <button class="btn btn-info btn-sm" (click)="loadRecord(record)">üìã Xem</button>
                      <button class="btn btn-warning btn-sm" (click)="deleteRecord(record.id)" style="margin-left: 5px;">üóëÔ∏è</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="calendar-section" *ngIf="showCalendar">
            <h4 class="section-title compact-section">üìÖ L·ªãch th√°ng ki·ªÉm k√™</h4>
            <div class="calendar-header">
              <button class="btn btn-outline-primary" (click)="previousMonth()">‚Äπ Th√°ng tr∆∞·ªõc</button>
              <h3 class="calendar-title">{{ getCurrentMonthYear() }}</h3>
              <button class="btn btn-outline-primary" (click)="nextMonth()">Th√°ng sau ‚Ä∫</button>
            </div>
            <div class="calendar-legend">
              <span class="legend-item">
                <span class="legend-color no-check"></span>
                <span>Ch∆∞a ki·ªÉm tra</span>
              </span>
              <span class="legend-item">
                <span class="legend-color checked"></span>
                <span>ƒê√£ ki·ªÉm tra</span>
              </span>
              <span class="legend-item">
                <span class="legend-color today"></span>
                <span>H√¥m nay</span>
              </span>
            </div>
            <div class="calendar-grid">
              <div class="calendar-weekdays">
                <div class="weekday">T2</div>
                <div class="weekday">T3</div>
                <div class="weekday">T4</div>
                <div class="weekday">T5</div>
                <div class="weekday">T6</div>
                <div class="weekday">T7</div>
                <div class="weekday">CN</div>
              </div>
              <div class="calendar-days">
                <div 
                  *ngFor="let day of getCalendarDays()" 
                  class="calendar-day"
                  [class.other-month]="!day.isCurrentMonth"
                  [class.today]="day.isToday"
                  [class.checked]="day.hasChecklist"
                  [class.no-check]="day.isCurrentMonth && !day.hasChecklist && !day.isToday"
                  [class.clickable]="day.isCurrentMonth"
                  (click)="onDayClick(day)"
                  [title]="getDayTooltip(day)"
                >
                  <span class="day-number">{{ day.day }}</span>
                  <span class="day-status" *ngIf="day.hasChecklist">‚úì</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button class="floating-save" (click)="saveData()" [disabled]="isLoading || !hasUnsavedChanges">
        <span class="loading-spinner" [class.show]="isLoading"></span>
        üíæ {{ isLoading ? 'ƒêang l∆∞u...' : 'L∆∞u d·ªØ li·ªáu' }}
      </button>

      <div class="notification" [class]="notificationClass" [class.show]="showNotification">
        {{ notificationMessage }}
      </div>
    </div>

  </div>
</div>
