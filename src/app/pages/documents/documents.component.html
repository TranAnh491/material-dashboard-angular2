<div class="main-content">
  <div class="container-fluid documents-container" [class.embedded]="selectedDocumentUrl">

    <!-- Document List View -->
    <div *ngIf="!selectedDocumentUrl && !showDailyChecklist" class="modern-checklist-interface">
      
      <!-- Quick Stats Overview -->
      <div class="stats-overview">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="material-icons">assignment</i>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ getTotalChecklists() }}</div>
            <div class="stat-label">Total Checklists</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon completed">
            <i class="material-icons">check_circle</i>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ getCompletedToday() }}</div>
            <div class="stat-label">Completed Today</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon in-progress">
            <i class="material-icons">hourglass_empty</i>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ getInProgressCount() }}</div>
            <div class="stat-label">In Progress</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon overdue">
            <i class="material-icons">warning</i>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ getOverdueCount() }}</div>
            <div class="stat-label">Overdue Items</div>
          </div>
        </div>
      </div>

      <!-- Search and Filter Section -->
      <div class="search-filter-section">
        <div class="search-container">
          <i class="material-icons search-icon">search</i>
          <input type="text" 
                 class="search-input" 
                 placeholder="Search checklists..." 
                 [(ngModel)]="searchQuery"
                 (input)="filterChecklists()">
        </div>
        
        <div class="filter-controls">
          <div class="filter-group">
            <label>Status:</label>
            <select class="filter-select" [(ngModel)]="statusFilter" (change)="filterChecklists()">
              <option value="">All Status</option>
              <option value="ready">Ready</option>
              <option value="in-progress">In Progress</option>
              <option value="pending">Pending</option>
              <option value="overdue">Overdue</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>Sort by:</label>
            <select class="filter-select" [(ngModel)]="sortBy" (change)="sortChecklists()">
              <option value="name">Name</option>
              <option value="status">Status</option>
              <option value="priority">Priority</option>
              <option value="date">Last Updated</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Modern Checklist Cards Grid -->
      <div class="checklist-grid">
        <div *ngFor="let checklist of filteredChecklists" class="modern-checklist-card" [class]="checklist.status">
          
          <!-- Card Header -->
          <div class="card-header">
            <div class="checklist-icon">
              <i class="material-icons">{{ checklist.icon }}</i>
            </div>
            <div class="status-badge" [class]="checklist.status">
              {{ getStatusLabel(checklist.status) }}
            </div>
          </div>

          <!-- Card Content -->
          <div class="card-content">
            <h3 class="checklist-title">{{ checklist.title }}</h3>
            <p class="checklist-description">{{ checklist.description }}</p>
            
            <!-- Progress Section - Hidden -->
            <!-- <div class="progress-section">
              <div class="progress-info">
                <span class="progress-label">Progress</span>
                <span class="progress-percentage">{{ checklist.completionPercentage }}%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="checklist.completionPercentage"></div>
              </div>
            </div> -->
            
            <!-- Metadata -->
            <div class="metadata">
              <div class="metadata-item">
                <i class="material-icons">list</i>
                <span>{{ checklist.itemCount }} items</span>
              </div>
              <div class="metadata-item">
                <i class="material-icons">person</i>
                <span>{{ checklist.assignedUser }}</span>
              </div>
              <div class="metadata-item">
                <i class="material-icons">schedule</i>
                <span>{{ checklist.lastUpdated | date:'MMM d, h:mm a' }}</span>
              </div>
            </div>
          </div>

          <!-- Card Actions -->
          <div class="card-actions">
            <button class="action-btn primary" (click)="openChecklist(checklist)">
              <i class="material-icons">open_in_new</i>
              Open
            </button>
            <!-- Removed Details and Edit buttons -->
            <!-- <button class="action-btn secondary" (click)="viewDetails(checklist)">
              <i class="material-icons">visibility</i>
              Details
            </button>
            <button class="action-btn tertiary" (click)="editChecklist(checklist)">
              <i class="material-icons">edit</i>
              Edit
            </button> -->
          </div>

          <!-- Loading Overlay -->
          <div class="loading-overlay" *ngIf="checklist.loading">
            <div class="loading-spinner">
              <i class="material-icons rotating">refresh</i>
            </div>
          </div>
        </div>
      </div>

      <!-- Rack Loading Section -->
      <div class="rack-loading-section">
        <div class="section-header">
          <h3 class="section-title">
            <i class="material-icons">inventory</i>
            Rack Loading
          </h3>
          <p class="section-description">Monitor loading capacity of main warehouse racks (A-G)</p>
          
          <!-- Summary Statistics - Moved up and compact -->
          <div class="summary-stats-compact">
            <div class="stat-item-compact">
              <div class="stat-icon-compact">
                <i class="material-icons">view_module</i>
              </div>
              <div class="stat-content-compact">
                <div class="stat-number-compact">{{ getTotalRacks() }}</div>
                <div class="stat-label-compact">Total Positions</div>
              </div>
            </div>
            <div class="stat-item-compact">
              <div class="stat-icon-compact">
                <i class="material-icons">fitness_center</i>
              </div>
              <div class="stat-content-compact">
                <div class="stat-number-compact">{{ getTotalWeight() | number:'1.0-0' }}</div>
                <div class="stat-label-compact">Total Weight (kg)</div>
              </div>
            </div>
            <div class="stat-item-compact">
              <div class="stat-icon-compact">
                <i class="material-icons">assessment</i>
              </div>
              <div class="stat-content-compact">
                <div class="stat-number-compact">{{ getUseRate() }}%</div>
                <div class="stat-label-compact">Use rate</div>
              </div>
            </div>
            <div class="stat-item-compact">
              <div class="stat-icon-compact">
                <i class="material-icons">warning</i>
              </div>
              <div class="stat-content-compact">
                <div class="stat-number-compact">{{ getHighUsageRacks() }}</div>
                <div class="stat-label-compact">Over 95%</div>
              </div>
            </div>
          </div>
          
          <div class="header-actions">
            <button class="refresh-btn" (click)="refreshRackData()" [disabled]="isRefreshing">
              <i class="material-icons">refresh</i>
              {{ isRefreshing ? 'Loading...' : 'Refresh Data' }}
            </button>
            <div class="status-info" *ngIf="lastRackDataUpdate">
              <span class="last-updated">
                Last updated: {{ lastRackDataUpdate | date:'MMM d, h:mm a' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Rack Loading Table -->
        <div class="rack-loading-table-container">
          <!-- Loading Overlay -->
          <div class="loading-overlay" *ngIf="isRefreshing">
            <div class="loading-content">
              <i class="material-icons rotating">refresh</i>
              <span>Loading rack data...</span>
            </div>
          </div>
          
          <table class="rack-loading-table">
            <thead>
              <tr>
                <th>Rack Position</th>
                <th>Max Capacity (kg)</th>
                <th>Current Load (kg)</th>
                <th>Usage (%)</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let rack of rackLoadingData" [class]="getRackStatusClass(rack.usage)">
                <td class="rack-position">
                  <i class="material-icons">view_module</i>
                  {{ rack.position }}
                </td>
                <td class="max-capacity">{{ rack.maxCapacity | number }}</td>
                <td class="current-load">{{ rack.currentLoad | number }}</td>
                <td class="usage-percentage">
                  <div class="usage-bar">
                    <div class="usage-fill" [style.width.%]="rack.usage" [class]="getUsageBarClass(rack.usage)"></div>
                  </div>
                  <span class="usage-text">{{ rack.usage | number:'1.1-1' }}%</span>
                </td>
                <td class="status">
                  <span class="status-badge" [class]="getRackStatusClass(rack.usage)">
                    {{ getRackStatusLabel(rack.usage) }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredChecklists.length === 0">
        <div class="empty-icon">
          <i class="material-icons">assignment</i>
        </div>
        <h3>No checklists found</h3>
        <p>Try adjusting your search or filter criteria</p>
      </div>

    </div>

    <!-- Embedded Document View -->
    <div *ngIf="selectedDocumentUrl" class="embedded-view">
      <div class="toolbar">
        <button (click)="closeDocument()" class="btn btn-white btn-round btn-just-icon mr-3">
          <i class="material-icons">arrow_back</i>
        </button>
        <span>Ho√†n th√†nh bi·ªÉu m·∫´u v√† nh·∫•n n√∫t quay l·∫°i.</span>
      </div>
      <div class="iframe-container">
        <iframe [src]="selectedDocumentUrl" width="100%" height="100%" frameborder="0">ƒêang t·∫£i...</iframe>
      </div>
    </div>

    <!-- Daily Checklist Shelves View -->
    <div *ngIf="showDailyChecklist" class="daily-checklist-view">
      <div class="toolbar compact-toolbar">
        <button (click)="closeDailyChecklist()" class="btn btn-white btn-round btn-just-icon mr-3">
          <i class="material-icons">arrow_back</i>
        </button>
        <span class="compact-header">Daily Checklist Shelves - Quay l·∫°i ƒë·ªÉ xem danh s√°ch t√†i li·ªáu.</span>
      </div>
      
              <div class="container">
        <div class="header">
          <h3 class="compact-title">
            üìã CHECKLIST K·ªÜ KHO
            <span *ngIf="hasUnsavedChanges" class="unsaved-indicator">‚Ä¢ Ch∆∞a l∆∞u</span>
          </h3>
        </div>
        
        <div class="toolbar">
          <div class="form-inputs">
            <div class="form-group">
              <label for="nguoiKiem">Ng∆∞·ªùi ki·ªÉm:</label>
              <select id="nguoiKiem" class="form-control" [(ngModel)]="currentData.nguoiKiem">
                <option value="">Ch·ªçn ng∆∞·ªùi ki·ªÉm</option>
                <option value="Ho√†ng V≈©">Ho√†ng V≈©</option>
                <option value="H·ªØu T√¨nh">H·ªØu T√¨nh</option>
                <option value="Ho√†ng Tu·∫•n">Ho√†ng Tu·∫•n</option>
                <option value="To√†n">To√†n</option>
                <option value="H∆∞ng">H∆∞ng</option>
                <option value="Ph√∫c">Ph√∫c</option>
                <option value="T√∫">T√∫</option>
              </select>
            </div>
            <div class="form-group">
              <label for="ngayKiem">Ng√†y ki·ªÉm:</label>
              <input type="date" id="ngayKiem" class="form-control" [(ngModel)]="currentData.ngayKiem">
            </div>
          </div>
          
          <div class="toolbar-actions">
            <button class="btn btn-primary" (click)="startNewChecklist()" [disabled]="isLoading">
              <span class="loading-spinner" [class.show]="isLoading"></span>
              üìù T·∫°o m·ªõi
            </button>
            <button class="btn btn-info" (click)="toggleHistory()" [disabled]="isLoading">
              ÔøΩÔøΩ {{ showHistory ? '·∫®n l·ªãch s·ª≠' : 'L·ªãch s·ª≠' }}
            </button>
            <button class="btn btn-warning" (click)="toggleCalendar()" [disabled]="isLoading">
              üìÖ {{ showCalendar ? '·∫®n l·ªãch' : 'L·ªãch th√°ng' }}
            </button>
            <button class="btn btn-success" (click)="exportData()" [disabled]="isLoading">
              üìã Xu·∫•t Excel
            </button>
            <button class="btn btn-primary" (click)="saveData()" [disabled]="isLoading || !hasUnsavedChanges">
              <span class="loading-spinner" [class.show]="isLoading"></span>
              üíæ L∆∞u ngay
            </button>
            <button class="btn btn-secondary btn-sm" (click)="debugCalendarDates()" title="Debug Calendar">
              üêõ
            </button>
          </div>
        </div>

        <div class="main-content">
          <div class="summary-cards">
            <div class="summary-card total">
              <div class="summary-number">{{ getTotalItems() }}</div>
              <div class="summary-label">T·ªïng m·ª•c</div>
            </div>
            <div class="summary-card ok">
              <div class="summary-number">{{ getCheckedItems() }}</div>
              <div class="summary-label">ƒê√£ ki·ªÉm</div>
            </div>
            <div class="summary-card ng">
              <div class="summary-number">{{ getNGItems() }}</div>
              <div class="summary-label">NG</div>
            </div>
            <div class="summary-card pending">
              <div class="summary-number">{{ getUncheckedItems() }}</div>
              <div class="summary-label">Ch∆∞a ki·ªÉm</div>
            </div>
          </div>

          <div class="checklist-section">
            <h4 class="section-title compact-section">üìã Danh m·ª•c ki·ªÉm tra</h4>
            <div class="table-container">
              <table class="checklist-table">
                <thead>
                  <tr>
                    <th>STT</th>
                    <th>Danh m·ª•c</th>
                    <th>M·ª•c ki·ªÉm tra</th>
                    <th>OK</th>
                    <th>NG</th>
                    <th>Ghi ch√∫</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of currentData.items; let i = index" [class.category-row]="item.category !== getPreviousCategory(i)">
                    <td>{{ i + 1 }}</td>
                    <td>{{ item.category }}</td>
                    <td>{{ item.item }}</td>
                    <td class="check-cell">
                      <input 
                        type="checkbox" 
                        class="checkbox-custom" 
                        [(ngModel)]="item.isOK"
                        (change)="updateItemStatus(i)">
                    </td>
                    <td class="check-cell">
                      <input 
                        type="checkbox" 
                        class="checkbox-custom checkbox-ng" 
                        [(ngModel)]="item.isNG"
                        (change)="updateItemStatus(i)">
                    </td>
                    <td>
                      <input 
                        type="text" 
                        class="notes-input" 
                        [(ngModel)]="item.notes"
                        (blur)="updateItemNotes(i)"
                        placeholder="Ghi ch√∫...">
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="history-section" *ngIf="showHistory">
            <h4 class="section-title compact-section">üìä L·ªãch s·ª≠ ki·ªÉm k√™</h4>
            <div class="table-container">
              <table class="history-table">
                <thead>
                  <tr>
                    <th>Ng√†y ki·ªÉm</th>
                    <th>K·ªá</th>
                    <th>Ng∆∞·ªùi ki·ªÉm</th>
                    <th>Ca ki·ªÉm</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>T·ªïng m·ª•c</th>
                    <th>Ho√†n th√†nh</th>
                    <th>Thao t√°c</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let record of historyData">
                    <td>{{ record.ngayKiem | date:'dd/MM/yyyy' }}</td>
                    <td>{{ record.kiemKe }}</td>
                    <td>{{ record.nguoiKiem }}</td>
                    <td>{{ record.caKiem }}</td>
                    <td>
                      <span class="status-badge" [class]="record.status">
                        {{ record.status === 'completed' ? 'Ho√†n th√†nh' : 'ƒêang th·ª±c hi·ªán' }}
                      </span>
                    </td>
                    <td>{{ record.items.length }}</td>
                    <td>{{ getCompletedCount(record.items) }}/{{ record.items.length }}</td>
                    <td>
                      <button class="btn btn-info btn-sm" (click)="loadRecord(record)">üìã Xem</button>
                      <button class="btn btn-warning btn-sm" (click)="deleteRecord(record.id)" style="margin-left: 5px;">üóëÔ∏è</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="calendar-section" *ngIf="showCalendar">
            <h4 class="section-title compact-section">üìÖ L·ªãch th√°ng ki·ªÉm k√™</h4>
            <div class="calendar-header">
              <button class="btn btn-outline-primary" (click)="previousMonth()">‚Äπ Th√°ng tr∆∞·ªõc</button>
              <h3 class="calendar-title">{{ getCurrentMonthYear() }}</h3>
              <button class="btn btn-outline-primary" (click)="nextMonth()">Th√°ng sau ‚Ä∫</button>
            </div>
            <div class="calendar-legend">
              <span class="legend-item">
                <span class="legend-color no-check"></span>
                <span>Ch∆∞a ki·ªÉm tra</span>
              </span>
              <span class="legend-item">
                <span class="legend-color checked"></span>
                <span>ƒê√£ ki·ªÉm tra</span>
              </span>
              <span class="legend-item">
                <span class="legend-color today"></span>
                <span>H√¥m nay</span>
              </span>
            </div>
            <div class="calendar-grid">
              <div class="calendar-days">
                <div 
                  *ngFor="let day of getCalendarDays()" 
                  class="calendar-day"
                  [class.other-month]="!day.isCurrentMonth"
                  [class.today]="day.isToday"
                  [class.checked]="day.hasChecklist"
                  [class.no-check]="day.isCurrentMonth && !day.hasChecklist && !day.isToday"
                  [class.clickable]="day.isCurrentMonth"
                  [class.sunday]="day.isSunday"
                  (click)="onDayClick(day)"
                  [title]="getDayTooltip(day)"
                >
                  <span class="day-weekday">{{ day.dayOfWeek }}</span>
                  <span class="day-number">{{ day.day }}</span>
                  <span class="day-status" *ngIf="day.hasChecklist">‚úì</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button class="floating-save" (click)="saveData()" [disabled]="isLoading || !hasUnsavedChanges">
        <span class="loading-spinner" [class.show]="isLoading"></span>
        üíæ {{ isLoading ? 'ƒêang l∆∞u...' : 'L∆∞u d·ªØ li·ªáu' }}
      </button>

      <div class="notification" [class]="notificationClass" [class.show]="showNotification">
        {{ notificationMessage }}
      </div>
    </div>

  </div>
</div>
