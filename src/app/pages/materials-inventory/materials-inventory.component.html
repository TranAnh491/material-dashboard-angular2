<div class="main-content">
  <!-- Excel-like Container -->
  <div class="excel-container">
    <!-- Excel Actions -->
    <div class="excel-actions">
      <div class="action-buttons">
        <div class="dropdown">
          <button class="btn btn-primary dropdown-toggle" type="button" (click)="toggleDropdown($event)">
            <i class="material-icons">more_vert</i>
            More
          </button>
          <div class="dropdown-menu" [class.show]="isDropdownOpen">
            <a class="dropdown-item" href="javascript:void(0)" (click)="importCatalog()">
              <i class="material-icons">upload_file</i>
              Import File Danh mục
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="downloadCatalogTemplate()">
              <i class="material-icons">download</i>
              Tải Template Danh mục
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="importCurrentStock()">
              <i class="material-icons">upload_file</i>
              Import Tồn kho hiện tại
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="downloadStockTemplate()">
              <i class="material-icons">download</i>
              Tải Template Tồn kho
            </a>
          </div>
        </div>
        <button class="btn btn-outline-success" (click)="refreshInventory()">
          <i class="material-icons">refresh</i>
          Refresh
        </button>
        <button class="btn btn-outline-warning" (click)="completeInventory()">
          <i class="material-icons">check_circle</i>
          Hoàn thành
        </button>
      </div>
    </div>

    <!-- Excel-like Body -->
    <div class="excel-body">
      <table class="excel-table">
        <thead>
          <tr>
            <th class="row-header">#</th>
            <th>Ngày nhập</th>
            <th>Mã hàng</th>
            <th>Quét</th>
            <th>Tên hàng</th>
            <th>Đơn vị</th>
            <th>Số P.O</th>
            <th>Lượng Nhập</th>
            <th>Xuất</th>
            <th>Tồn kho</th>
            <th>Vị trí</th>
            <th>Loại hình</th>
            <th>HSD</th>
            <th>KK</th>
            <th>Ghi chú</th>
            <th>Số cuộn/ bịch</th>
            <th>Lưu ý</th>
            <th>Trạng thái</th>
            <th>Xóa</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let material of filteredInventory; let i = index" 
              [class.duplicate-row]="material.isDuplicate">
            <td class="row-header">{{i + 1}}</td>
            <td class="date-cell" [class.duplicate-cell]="material.isDuplicate">{{material.receivedDate | date:'dd/MM/yyyy'}}</td>
            <td class="code-cell" [class.duplicate-cell]="material.isDuplicate">{{material.materialCode}}</td>
            <td class="scan-cell">
              <button class="qr-button" 
                      (click)="scanQRCode(material)"
                      matTooltip="Quét QR code để xuất hàng">
                QR
              </button>
            </td>
            <td class="material-name-cell" [class.duplicate-cell]="material.isDuplicate" 
                [title]="material.materialName || 'N/A'">{{material.materialName || 'N/A'}}</td>
            <td [class.duplicate-cell]="material.isDuplicate">{{material.unit}}</td>
            <td [class.duplicate-cell]="material.isDuplicate">{{material.poNumber}}</td>
            <td class="number-cell" [class.duplicate-cell]="material.isDuplicate">{{material.quantity | number}}</td>
            <td class="number-cell">
              <input type="number" class="editable-cell" [(ngModel)]="material.exported" (change)="updateExported(material)" min="0">
            </td>
            <td class="number-cell" [class.duplicate-cell]="material.isDuplicate">{{material.stock || material.quantity | number}}</td>
            <td>
              <input type="text" class="editable-cell" [(ngModel)]="material.location" (change)="updateLocation(material)">
            </td>
            <td>
              <input type="text" class="editable-cell" [(ngModel)]="material.type" (change)="updateType(material)">
            </td>
            <td class="date-cell" [class.duplicate-cell]="material.isDuplicate">{{material.expiryDate | date:'dd/MM/yyyy'}}</td>
            <td class="status-cell">
              <mat-checkbox [checked]="material.qualityCheck" disabled>
              </mat-checkbox>
            </td>
            <td>
              <input type="text" class="editable-cell" [(ngModel)]="material.notes" (change)="updateNotes(material)">
            </td>
            <td class="number-cell" [class.duplicate-cell]="material.isDuplicate">{{material.rollsOrBags}}</td>
            <td>
              <input type="text" class="editable-cell" [(ngModel)]="material.remarks" (change)="updateRemarks(material)">
            </td>
            <td class="status-cell">
              <span class="badge badge-success">In Stock</span>
            </td>
            <td class="status-cell">
              <button mat-icon-button color="warn" (click)="deleteInventoryItem(material)" 
                      matTooltip="Xóa item này khỏi Inventory">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- No Data Message -->
      <div class="no-data" *ngIf="filteredInventory.length === 0">
        <i class="material-icons">inventory</i>
        <h5>No Inventory Items</h5>
        <p>No materials have been marked as received in Inbound Materials tab</p>
      </div>
    </div>
  </div>

  <!-- QR Scanner Modal -->
  <div class="qr-scanner-modal" *ngIf="isScanning">
    <div class="modal-overlay" (click)="stopScanning()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h5>
          <i class="material-icons">qr_code_scanner</i>
          Quét QR Code
        </h5>
        <button class="close-btn" (click)="stopScanning()">
          <i class="material-icons">close</i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="scanner-container">
          <div id="qr-reader"></div>
          <div class="scanner-overlay">
            <div class="scanner-frame"></div>
            <p class="scanner-hint">Đặt QR code vào khung hình</p>
          </div>
        </div>
        
        <div class="scanner-info" *ngIf="currentScanningMaterial">
          <p><strong>Mã hàng:</strong> {{currentScanningMaterial.materialCode}}</p>
          <p><strong>PO:</strong> {{currentScanningMaterial.poNumber}}</p>
          <p><strong>Tồn kho:</strong> {{currentScanningMaterial.stock || currentScanningMaterial.quantity}}</p>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="stopScanning()">
          <i class="material-icons">cancel</i>
          Hủy
        </button>
      </div>
    </div>
  </div>
</div>
