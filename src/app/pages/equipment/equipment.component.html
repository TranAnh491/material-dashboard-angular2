<div class="main-content">
  <div class="container-fluid">
    <div class="toolbar">
      <button class="btn btn-info" (click)="toggleLanguage()">
        <i class="material-icons">language</i> {{ isEnglish ? 'Tiếng Việt' : 'English' }}
      </button>
    </div>

    <!-- Three Menu Cards Layout -->
    <div class="menu-cards-layout">
      
      <!-- Menu Card 1: Work Instruction -->
      <div class="menu-card" (click)="toggleWorkInstruction()">
        <div class="menu-card-icon">
          <i class="material-icons">integration_instructions</i>
        </div>
        <div class="menu-card-content">
          <h3>Work Instruction</h3>
          <p>Hướng dẫn các bước công việc</p>
        </div>
        <div class="menu-card-arrow">
          <i class="material-icons">{{ showWorkInstruction ? 'expand_less' : 'expand_more' }}</i>
        </div>
      </div>

      <!-- Menu Card 2: Test -->
      <div class="menu-card" (click)="toggleTest()">
        <div class="menu-card-icon test">
          <i class="material-icons">quiz</i>
        </div>
        <div class="menu-card-content">
          <h3>Temp + %Rh Test</h3>
          <p>Kiểm tra kiến thức</p>
        </div>
        <div class="menu-card-arrow">
          <i class="material-icons">{{ showTest ? 'expand_less' : 'expand_more' }}</i>
        </div>
      </div>

      <!-- Menu Card 3: Report -->
      <div class="menu-card" (click)="toggleReport()">
        <div class="menu-card-icon report">
          <i class="material-icons">assessment</i>
        </div>
        <div class="menu-card-content">
          <h3>Report</h3>
          <p>Báo cáo đào tạo</p>
        </div>
        <div class="menu-card-arrow">
          <i class="material-icons">{{ showReport ? 'expand_less' : 'expand_more' }}</i>
        </div>
      </div>

    </div>

    <!-- Work Instruction Content (Expanded) -->
    <div *ngIf="showWorkInstruction" class="expanded-content work-instruction-content">
      <div class="content-header">
        <h2>
          <i class="material-icons">integration_instructions</i>
          Work Instruction
        </h2>
        <button class="close-btn" (click)="closeAll()">
          <i class="material-icons">close</i>
        </button>
      </div>
      <div class="instruction-container">
        <!-- Left Column: Step List -->
        <div class="step-list">
          <div *ngFor="let step of steps" 
               class="step-item" 
               [ngClass]="{'active': step === selectedStep, 'material': step.type === 'material', 'product': step.type === 'product'}" 
               (click)="selectStep(step)">
            <i class="material-icons item-icon">{{ step.icon }}</i>
            <span class="step-text">{{ isEnglish ? step.en : step.vi }}</span>
          </div>
        </div>
        <!-- Right Column: Image Viewer -->
        <div class="image-viewer">
          <div *ngIf="selectedStep?.imageUrl" class="image-container">
            <img [src]="selectedStep.imageUrl" [alt]="isEnglish ? selectedStep.en : selectedStep.vi" (error)="selectedStep.imageUrl = ''">
          </div>
          <div *ngIf="!selectedStep?.imageUrl" class="no-image-placeholder">
            <i class="material-icons">image</i>
            <h3>{{ isEnglish ? 'No Image' : 'Chưa có hình ảnh' }}</h3>
            <p>{{ isEnglish ? 'Please add an image for this step.' : 'Vui lòng thêm hình ảnh cho bước này.' }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Test Content (Expanded) -->
    <div *ngIf="showTest" class="expanded-content test-content">
      <div class="content-header">
        <h2>
          <i class="material-icons">quiz</i>
          Temp + %Rh Test
        </h2>
        <button class="close-btn" (click)="closeAll()">
          <i class="material-icons">close</i>
        </button>
      </div>
      <div class="test-content-expanded">
        <!-- Temperature Knowledge Test Card -->
        <div class="modern-checklist-card ready">
          <div class="card-header">
            <div class="checklist-icon">
              <i class="material-icons">quiz</i>
            </div>
            <div class="status-badge ready">
              Knowledge Test
            </div>
          </div>

          <div class="card-content">
            <h3 class="checklist-title">Kiểm tra kiến thức</h3>
            <p class="checklist-description">Hướng dẫn ghi, lưu trữ và xử lý về nhiệt độ độ ẩm</p>
          </div>

          <div class="card-actions">
            <button class="action-btn primary" (click)="openTemperatureKnowledgeTest()">
              <i class="material-icons">school</i>
              Làm bài kiểm tra
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Report Content (Expanded) -->
    <div *ngIf="showReport" class="expanded-content report-content">
      <div class="content-header">
        <h2>
          <i class="material-icons">assessment</i>
          Report
        </h2>
        <div class="header-actions">
          <button mat-icon-button 
                  color="primary" 
                  (click)="refreshReportData()"
                  matTooltip="Làm mới dữ liệu"
                  class="refresh-btn"
                  [disabled]="isLoadingReport">
            <mat-icon>refresh</mat-icon>
          </button>
          <button class="close-btn" (click)="closeAll()">
            <i class="material-icons">close</i>
          </button>
        </div>
      </div>
      <div class="report-content-expanded">
        <!-- Simple Training Report Table -->
        <div class="report-table-container">
          <div *ngIf="isLoadingReport" class="loading-container">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Đang tải danh sách báo cáo đào tạo...</p>
            <p style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">
              Đang kiểm tra dữ liệu mới nhất từ Firebase...
            </p>
          </div>

          <div *ngIf="!isLoadingReport && filteredReportData.length === 0" class="empty-state">
            <i class="material-icons">assignment</i>
            <h3>Chưa có dữ liệu báo cáo</h3>
            <p>Không có dữ liệu đào tạo nào cho nhân viên ASP.</p>
          </div>

          <div *ngIf="!isLoadingReport && filteredReportData.length > 0" class="table-responsive">
            <div class="table-info">
              <p style="font-size: 12px; color: #7f8c8d; margin-bottom: 15px;">
                <mat-icon style="font-size: 14px; vertical-align: middle;">info</mat-icon>
                Không thấy bài kiểm tra mới nhất? Nhấn nút 
                <mat-icon style="font-size: 14px; vertical-align: middle;">refresh</mat-icon> 
                để làm mới dữ liệu.
              </p>
            </div>
            <table mat-table [dataSource]="filteredReportData" class="report-table mat-elevation-2">
              
              <!-- Employee ID Column -->
              <ng-container matColumnDef="employeeId">
                <th mat-header-cell *matHeaderCellDef>Mã số nhân viên</th>
                <td mat-cell *matCellDef="let element">{{ element.employeeId }}</td>
              </ng-container>

              <!-- Name Column -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Tên nhân viên</th>
                <td mat-cell *matCellDef="let element">
                  <div class="employee-name-cell">
                    {{ element.name }}
                    <mat-icon *ngIf="element.signature" 
                              class="signature-indicator" 
                              matTooltip="Có chữ ký điện tử">
                      verified
                    </mat-icon>
                    <mat-icon *ngIf="!element.signature" 
                              class="no-signature-indicator" 
                              matTooltip="Chưa có chữ ký điện tử">
                      edit
                    </mat-icon>
                  </div>
                </td>
              </ng-container>

              <!-- Training Content Column -->
              <ng-container matColumnDef="trainingContent">
                <th mat-header-cell *matHeaderCellDef>Nội dung đào tạo</th>
                <td mat-cell *matCellDef="let element">{{ element.trainingContent }}</td>
              </ng-container>

              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Trạng thái</th>
                <td mat-cell *matCellDef="let element">
                  <span class="simple-status" [ngClass]="element.status">
                    {{ element.status === 'pass' ? 'Đạt' : 'Không đạt' }}
                  </span>
                </td>
              </ng-container>

              <!-- Training Date Column -->
              <ng-container matColumnDef="trainingDate">
                <th mat-header-cell *matHeaderCellDef>Ngày đào tạo</th>
                <td mat-cell *matCellDef="let element">{{ element.trainingDate | date:'dd/MM/yyyy' }}</td>
              </ng-container>

              <!-- Expiry Date Column -->
              <ng-container matColumnDef="expiryDate">
                <th mat-header-cell *matHeaderCellDef>Ngày hết hạn</th>
                <td mat-cell *matCellDef="let element" [ngClass]="{'expired': isExpired(element.expiryDate)}">
                  {{ element.expiryDate | date:'dd/MM/yyyy' }}
                  <span *ngIf="isExpired(element.expiryDate)" class="expired-text"> (Hết hạn)</span>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef class="actions-header">Thao tác</th>
                <td mat-cell *matCellDef="let element" class="actions-cell">
                  <div class="action-buttons">
                    <button mat-icon-button 
                            color="primary" 
                            (click)="downloadEmployeeReport(element)"
                            matTooltip="Tải file báo cáo"
                            class="download-btn">
                      <mat-icon>download</mat-icon>
                    </button>
                    <button mat-icon-button 
                            color="warn" 
                            (click)="deleteEmployee(element)"
                            matTooltip="Xóa bản ghi"
                            class="delete-btn">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 