<div class="main-content">
  <!-- Excel-like Container -->
  <div class="excel-container">
    <!-- Excel-like Header -->
    <div class="excel-header">
      <h4>üì¶ INBOUND ASM1</h4>
    </div>
    
    <!-- Excel-like Actions -->
    <div class="excel-actions">
      <div class="action-controls-horizontal">
        <!-- More Dropdown -->
        <div class="dropdown">
          <button class="custom-btn dropdown-toggle" type="button" id="moreDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="material-icons">more_vert</i>
            More
          </button>
          <div class="dropdown-menu" aria-labelledby="moreDropdown">
            <a class="dropdown-item" href="javascript:void(0)" (click)="importFromExcel(); $event.preventDefault()">
              <i class="material-icons">file_upload</i>
              Import Excel
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="exportToExcel(); $event.preventDefault()">
              <i class="material-icons">download</i>
              Export Excel
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="javascript:void(0)" (click)="addMaterial(); $event.preventDefault()">
              <i class="material-icons">add</i>
              Th√™m Material
            </a>
            <a class="dropdown-item" href="javascript:void(0)" (click)="clearFilters(); $event.preventDefault()">
              <i class="material-icons">clear</i>
              X√≥a Filter
            </a>
          </div>
        </div>
        
        <!-- Search Box with Type -->
        <div class="search-group">
          <input type="text" 
                 [placeholder]="getSearchPlaceholder()" 
                 [(ngModel)]="searchTerm"
                 (input)="onSearchChange()"
                 class="custom-input search-input">
          <select class="search-type-select" [(ngModel)]="searchType" (change)="onSearchTypeChange()">
            <option value="all">T·∫•t c·∫£</option>
            <option value="materialCode">M√£ h√†ng</option>
            <option value="batchNumber">L√¥ h√†ng</option>
            <option value="poNumber">PO</option>
          </select>
        </div>
        
        <!-- Status Filter -->
        <select class="status-filter-select" [(ngModel)]="statusFilter" (change)="onStatusFilterChange()">
          <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
          <option value="completed">Ho√†n th√†nh</option>
          <option value="pending">Ch∆∞a ho√†n th√†nh</option>
        </select>
        
        <!-- Date Filters -->
        <div class="date-group">
          <label>T·ª´ ng√†y:</label>
          <input type="date" [(ngModel)]="startDate" (change)="onDateFilterChange()" class="date-input">
          <label>ƒê·∫øn ng√†y:</label>
          <input type="date" [(ngModel)]="endDate" (change)="onDateFilterChange()" class="date-input">
        </div>
        
        <!-- Refresh Button -->
        <button class="custom-btn refresh-btn" (click)="loadMaterials()">
          <i class="material-icons">refresh</i>
          Refresh
        </button>
      </div>
    </div>
    
    <!-- Loading State -->
    <div class="loading-container" *ngIf="isLoading">
      <div class="loading-spinner">
        <i class="material-icons spinning">refresh</i>
        <span>ƒêang t·∫£i d·ªØ li·ªáu ASM1...</span>
      </div>
    </div>
    
    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">
      <i class="material-icons">error</i>
      {{errorMessage}}
    </div>
    
    <!-- Excel-like Body -->
    <div class="excel-body" *ngIf="!isLoading">
      <table class="excel-table">
        <thead>
          <tr>
            <th>Factory</th>
            <th class="row-header">#</th>
            <th>Ng√†y nh·∫≠p</th>
            <th>L√¥ H√†ng/ DNNK</th>
            <th>M√£ h√†ng</th>
            <th>S·ªë P.O</th>
            <th>L∆∞·ª£ng Nh·∫≠p</th>
            <th>V·ªã tr√≠</th>
            <th>Lo·∫°i h√¨nh</th>
            <th>HSD</th>
            <th>KK</th>
            <th>ƒê√£ nh·∫≠n</th>
            <th>Ghi ch√∫</th>
            <th>S·ªë ƒë∆°n v·ªã</th>
            <th>L∆∞·ª£ng H√†ng</th>
            <th>Nh√† cung c·∫•p</th>
            <th>L∆∞u √Ω</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Ho√†n th√†nh</th>
            <th>X√≥a</th>
            <th class="print-column-header">Print</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let material of getPaginatedMaterials(); let i = index" 
              [class.received-row]="material.isReceived"
              [class.completed-row]="material.isCompleted">
            <td class="factory-cell factory-asm1">
              ASM1
            </td>
            <td class="row-header">{{(currentPage - 1) * itemsPerPage + i + 1}}</td>
            <td class="date-cell">{{formatDate(material.importDate)}}</td>
            <td class="batch-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.batchNumber" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials">
            </td>
            <td class="code-cell" 
                [class.material-code-printed]="material.hasQRGenerated"
                [class.material-received]="material.isReceived">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.materialCode" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials">
            </td>
            <td class="po-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.poNumber" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials">
            </td>
            <td class="number-cell">
              <input type="number" 
                     class="editable-input" 
                     [(ngModel)]="material.quantity" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials"> 
              <input type="text" 
                     class="editable-input unit-input" 
                     [(ngModel)]="material.unit" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials"
                     placeholder="ƒë∆°n v·ªã">
            </td>
            <td class="location-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.location" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials"
                     placeholder="V·ªã tr√≠">
            </td>
            <td class="type-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.type" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials"
                     placeholder="Lo·∫°i">
            </td>
            <td class="date-cell">
              <input type="date" 
                     class="date-input" 
                     [value]="material.expiryDate ? material.expiryDate.toISOString().split('T')[0] : ''"
                     (change)="onExpiryDateChange($event, material)"
                     [disabled]="!canEditMaterials">
            </td>
            <td class="status-cell">
              <input type="checkbox" 
                     [checked]="material.qualityCheck" 
                     (change)="material.qualityCheck = $event.target.checked; updateMaterial(material)"
                     [disabled]="!canEditMaterials">
            </td>
            <td class="status-cell">
              <input type="checkbox" 
                     [checked]="material.isReceived" 
                     (change)="onReceivedChange($event, material)"
                     [disabled]="!canEditMaterials || material.isReceived"
                     [title]="material.isReceived ? 'ƒê√£ chuy·ªÉn v√†o Inventory ASM1' : 'Tick ƒë·ªÉ chuy·ªÉn v√†o Inventory ASM1'">
            </td>
            <td class="notes-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.notes" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials"
                     placeholder="Ghi ch√∫">
            </td>
            <td class="number-cell">
              <input type="number" 
                     class="editable-input" 
                     [(ngModel)]="material.rollsOrBags" 
                     (change)="updateMaterial(material)" 
                     min="0" 
                     [disabled]="!canEditMaterials">
            </td>
            <td class="number-cell">{{material.quantity / (material.rollsOrBags || 1) | number:'1.0-2'}} {{material.unit}}</td>
            <td class="supplier-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.supplier" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials"
                     placeholder="Nh√† cung c·∫•p">
            </td>
            <td class="remarks-cell">
              <input type="text" 
                     class="editable-input" 
                     [(ngModel)]="material.remarks" 
                     (change)="updateMaterial(material)"
                     [disabled]="!canEditMaterials"
                     placeholder="L∆∞u √Ω">
            </td>
            <td class="status-cell">
              <span class="status-badge" [ngClass]="getStatusBadgeClass(material)">
                {{getStatusText(material)}}
              </span>
            </td>
            <td class="status-cell">
              <button class="action-btn complete-btn" 
                      (click)="material.isCompleted = true; updateMaterial(material)" 
                      [disabled]="material.isCompleted || !canEditMaterials"
                      title="ƒê√°nh d·∫•u ho√†n th√†nh">
                <i class="material-icons">check_circle</i>
              </button>
            </td>
            <td class="status-cell">
              <button class="action-btn delete-btn" 
                      (click)="deleteMaterial(material)" 
                      [disabled]="!canDeleteMaterials"
                      title="X√≥a material">
                <i class="material-icons">delete</i>
              </button>
            </td>
            <td class="print-cell">
              <button class="print-qr-btn" 
                      (click)="generateQRCode(material)" 
                      [disabled]="!canGenerateQR"
                      title="In QR Code ASM1">
                <i class="material-icons">print</i>
                Print
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination-info">
        Trang {{currentPage}} / {{totalPages}} - T·ªïng: {{filteredMaterials.length}} materials
      </div>
      <div class="pagination-controls">
        <button class="page-btn" (click)="previousPage()" [disabled]="currentPage <= 1">
          <i class="material-icons">chevron_left</i>
        </button>
        <button class="page-btn" 
                *ngFor="let page of [].constructor(totalPages); let i = index"
                [class.active]="currentPage === i + 1"
                (click)="goToPage(i + 1)">
          {{i + 1}}
        </button>
        <button class="page-btn" (click)="nextPage()" [disabled]="currentPage >= totalPages">
          <i class="material-icons">chevron_right</i>
        </button>
      </div>
    </div>
    
  </div>
</div>

<!-- File Upload (Hidden) -->
<input type="file" 
       #fileInput 
       accept=".xlsx,.xls,.csv" 
       style="display: none" 
       (change)="onFileSelect($event)">
