<div class="warehouse-loading-container">
  <!-- Factory Selection Screen -->
  <div class="factory-selection" *ngIf="!selectedFactory">
    <div class="selection-card">
      <h2>üìä Warehouse Loading Report</h2>
      <p class="subtitle">Ch·ªçn nh√† m√°y ƒë·ªÉ xem b√°o c√°o s·ª≠ d·ª•ng kh√¥ng gian kho</p>
      
      <div class="factory-buttons">
        <button class="factory-btn asm1" (click)="selectFactory('ASM1')">
          <i class="material-icons">factory</i>
          <span>ASM1</span>
          <small>Nh√† m√°y 1</small>
        </button>
        
        <button class="factory-btn asm2" (click)="selectFactory('ASM2')">
          <i class="material-icons">factory</i>
          <span>ASM2</span>
          <small>Nh√† m√°y 2</small>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner">
      <i class="material-icons rotating">sync</i>
      <p>ƒêang t·∫£i d·ªØ li·ªáu {{selectedFactory}}...</p>
    </div>
  </div>

  <!-- Warehouse Report Screen -->
  <div class="warehouse-report" *ngIf="selectedFactory && !isLoading && warehouseStats">
    <!-- Header -->
    <div class="report-header">
      <button class="back-btn" (click)="backToSelection()">
        <i class="material-icons">arrow_back</i>
        Quay l·∫°i
      </button>
      <h2>üìä Warehouse Loading Report - {{selectedFactory}}</h2>
      <button class="export-btn" (click)="exportToExcel()">
        <i class="material-icons">download</i>
        Export Excel
      </button>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="stat-card primary">
        <i class="material-icons">inventory_2</i>
        <div class="stat-content">
          <h3>{{warehouseStats.totalMaterials}}</h3>
          <p>T·ªïng s·ªë m√£ h√†ng</p>
        </div>
      </div>

      <div class="stat-card success">
        <i class="material-icons">place</i>
        <div class="stat-content">
          <h3>{{warehouseStats.usedLocations}}</h3>
          <p>V·ªã tr√≠ ƒëang s·ª≠ d·ª•ng</p>
        </div>
      </div>

      <div class="stat-card warning">
        <i class="material-icons">place</i>
        <div class="stat-content">
          <h3>{{warehouseStats.emptyLocations}}</h3>
          <p>V·ªã tr√≠ c√≤n tr·ªëng</p>
        </div>
      </div>

      <div class="stat-card info">
        <i class="material-icons">assessment</i>
        <div class="stat-content">
          <h3>{{warehouseStats.utilizationRate | number:'1.1-1'}}%</h3>
          <p>T·ª∑ l·ªá s·ª≠ d·ª•ng</p>
        </div>
      </div>
    </div>

    <!-- Utilization Bar -->
    <div class="utilization-section">
      <h3>S·ª≠ d·ª•ng kh√¥ng gian kho</h3>
      <div class="utilization-bar-container">
        <div class="utilization-bar">
          <div class="utilization-fill" 
               [style.width.%]="warehouseStats.utilizationRate"
               [class.low]="warehouseStats.utilizationRate < 50"
               [class.medium]="warehouseStats.utilizationRate >= 50 && warehouseStats.utilizationRate < 80"
               [class.high]="warehouseStats.utilizationRate >= 80">
          </div>
        </div>
        <div class="utilization-labels">
          <span>0%</span>
          <span>25%</span>
          <span>50%</span>
          <span>75%</span>
          <span>100%</span>
        </div>
      </div>
      <div class="utilization-stats">
        <div class="stat-item">
          <span class="stat-dot used"></span>
          <span>ƒê√£ s·ª≠ d·ª•ng: {{warehouseStats.usedLocations}} v·ªã tr√≠ ({{warehouseStats.utilizationRate | number:'1.1-1'}}%)</span>
        </div>
        <div class="stat-item">
          <span class="stat-dot empty"></span>
          <span>C√≤n tr·ªëng: {{warehouseStats.emptyLocations}} v·ªã tr√≠ ({{100 - warehouseStats.utilizationRate | number:'1.1-1'}}%)</span>
        </div>
      </div>
    </div>

    <!-- Top Locations Chart (Simple Bar Chart) -->
    <div class="chart-section">
      <h3>Top 20 v·ªã tr√≠ c√≥ nhi·ªÅu m√£ h√†ng nh·∫•t</h3>
      <div class="bar-chart">
        <div class="bar-item" *ngFor="let stat of warehouseStats.locationStats.slice(0, 20); let i = index">
          <div class="bar-label">{{stat.location}}</div>
          <div class="bar-wrapper">
            <div class="bar-fill" 
                 [style.width.%]="(stat.totalItems / warehouseStats.locationStats[0].totalItems) * 100">
              <span class="bar-value">{{stat.totalItems}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Location Details Table - Separated by Warehouse Type -->
    <div class="table-section">
      <h3>Chi ti·∫øt theo v·ªã tr√≠ ({{warehouseStats.locationStats.length}} v·ªã tr√≠)</h3>
      
      <!-- Kho th∆∞·ªùng Section -->
      <div class="warehouse-section" *ngIf="normalWarehouseStats.length > 0">
        <h4 class="section-title warehouse-normal-title">
          <i class="material-icons">warehouse</i>
          Kho th∆∞·ªùng ({{normalWarehouseStats.length}} v·ªã tr√≠)
        </h4>
        <div class="table-wrapper">
          <table class="details-table">
            <thead>
              <tr>
                <th>#</th>
                <th>V·ªã tr√≠ (ƒë√£ gom)</th>
                <th>S·ªë l∆∞·ª£ng m√£ h√†ng</th>
                <th>T·ªïng s·ªë l∆∞·ª£ng</th>
                <th>V·ªã tr√≠ g·ªëc</th>
                <th>Danh s√°ch m√£ h√†ng</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let stat of normalWarehouseStats; let i = index">
                <td>{{i + 1}}</td>
                <td><strong>{{stat.location}}</strong></td>
                <td>{{stat.totalItems}}</td>
                <td>{{stat.totalQuantity | number:'1.0-0'}}</td>
                <td class="original-locations-cell">
                  <span class="location-chip" *ngFor="let origLoc of stat.originalLocations.slice(0, 3)">
                    {{origLoc}}
                  </span>
                  <span class="more-indicator" *ngIf="stat.originalLocations.length > 3">
                    +{{stat.originalLocations.length - 3}} v·ªã tr√≠
                  </span>
                </td>
                <td class="materials-cell">
                  <span class="material-chip" *ngFor="let material of stat.materials.slice(0, 5)">
                    {{material}}
                  </span>
                  <span class="more-indicator" *ngIf="stat.materials.length > 5">
                    +{{stat.materials.length - 5}} more
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Kho l·∫°nh Section -->
      <div class="warehouse-section" *ngIf="coldWarehouseStats.length > 0">
        <h4 class="section-title warehouse-cold-title">
          <i class="material-icons">ac_unit</i>
          Kho l·∫°nh ({{coldWarehouseStats.length}} v·ªã tr√≠)
        </h4>
        <div class="table-wrapper">
          <table class="details-table">
            <thead>
              <tr>
                <th>#</th>
                <th>V·ªã tr√≠ (ƒë√£ gom)</th>
                <th>S·ªë l∆∞·ª£ng m√£ h√†ng</th>
                <th>T·ªïng s·ªë l∆∞·ª£ng</th>
                <th>V·ªã tr√≠ g·ªëc</th>
                <th>Danh s√°ch m√£ h√†ng</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let stat of coldWarehouseStats; let i = index">
                <td>{{i + 1}}</td>
                <td><strong>{{stat.location}}</strong></td>
                <td>{{stat.totalItems}}</td>
                <td>{{stat.totalQuantity | number:'1.0-0'}}</td>
                <td class="original-locations-cell">
                  <span class="location-chip" *ngFor="let origLoc of stat.originalLocations.slice(0, 3)">
                    {{origLoc}}
                  </span>
                  <span class="more-indicator" *ngIf="stat.originalLocations.length > 3">
                    +{{stat.originalLocations.length - 3}} v·ªã tr√≠
                  </span>
                </td>
                <td class="materials-cell">
                  <span class="material-chip" *ngFor="let material of stat.materials.slice(0, 5)">
                    {{material}}
                  </span>
                  <span class="more-indicator" *ngIf="stat.materials.length > 5">
                    +{{stat.materials.length - 5}} more
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- No Data State -->
  <div class="no-data" *ngIf="selectedFactory && !isLoading && !warehouseStats">
    <i class="material-icons">inventory</i>
    <h3>Kh√¥ng c√≥ d·ªØ li·ªáu</h3>
    <p>Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu kho cho {{selectedFactory}}</p>
    <button class="back-btn" (click)="backToSelection()">
      <i class="material-icons">arrow_back</i>
      Quay l·∫°i ch·ªçn nh√† m√°y
    </button>
  </div>
</div>

